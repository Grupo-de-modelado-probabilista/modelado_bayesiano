<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Modelado Bayesiano - 6&nbsp; Regresión lineal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_Regresión_lineal_con_Bambi.html" rel="next">
<link href="./04_Diagnóstico_MCMC.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="citation_title" content="[6]{.chapter-number}&nbsp; [Regresión lineal]{.chapter-title}">
<meta name="citation_publication_date" content="2023-04-21">
<meta name="citation_cover_date" content="2023-04-21">
<meta name="citation_year" content="2023">
<meta name="citation_doi" content="https://doi.org/10.5281/zenodo.7851296">
<meta name="citation_language" content="es">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regresión lineal</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelado Bayesiano</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="" title="github" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-github"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/Grupo-de-modelado-probabilista/Modelado_Bayesiano">
          Fuente
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/Grupo-de-modelado-probabilista/Modelado_Bayesiano/issues/new">
          Reportar errores
          </a>
        </li>
    </ul>
    <a href="https://cafecito.app/aloctavodia" title="donaciones" class="sidebar-tool px-1"><i class="bi bi-cup"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">‎</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_Probabilidad.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probabilidad</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_Inferencia_Bayesiana.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Inferencia Bayesiana</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Programación_probabilística.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Programación probabilista</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Modelos_jerárquicos.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modelado Jerárquico</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Diagnóstico_MCMC.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Diagnóstico del muestreo</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_Regresión_lineal.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regresión lineal</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_Regresión_lineal_con_Bambi.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regresión lineal con Bambi</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_Comparación_de_modelos.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Comparación de modelos</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#la-idea-central-en-regresión-lineal" id="toc-la-idea-central-en-regresión-lineal" class="nav-link active" data-scroll-target="#la-idea-central-en-regresión-lineal"><span class="toc-section-number">6.1</span>  La idea central en regresión lineal</a></li>
  <li><a href="#bicicletas-lineales" id="toc-bicicletas-lineales" class="nav-link" data-scroll-target="#bicicletas-lineales"><span class="toc-section-number">6.2</span>  Bicicletas lineales</a>
  <ul class="collapse">
  <li><a href="#interpretando-la-media-a-posteriori" id="toc-interpretando-la-media-a-posteriori" class="nav-link" data-scroll-target="#interpretando-la-media-a-posteriori"><span class="toc-section-number">6.2.1</span>  Interpretando la media a posteriori</a></li>
  <li><a href="#interpretando-las-predicciones-a-posteriori" id="toc-interpretando-las-predicciones-a-posteriori" class="nav-link" data-scroll-target="#interpretando-las-predicciones-a-posteriori"><span class="toc-section-number">6.2.2</span>  Interpretando las predicciones a posteriori</a></li>
  </ul></li>
  <li><a href="#generalizando-el-modelo-lineal" id="toc-generalizando-el-modelo-lineal" class="nav-link" data-scroll-target="#generalizando-el-modelo-lineal"><span class="toc-section-number">6.3</span>  Generalizando el modelo lineal</a></li>
  <li><a href="#generalizando-el-modelo-lineal-para-datos-de-conteo" id="toc-generalizando-el-modelo-lineal-para-datos-de-conteo" class="nav-link" data-scroll-target="#generalizando-el-modelo-lineal-para-datos-de-conteo"><span class="toc-section-number">6.4</span>  Generalizando el modelo lineal para datos de conteo</a></li>
  <li><a href="#regresión-robusta" id="toc-regresión-robusta" class="nav-link" data-scroll-target="#regresión-robusta"><span class="toc-section-number">6.5</span>  Regresión robusta</a></li>
  <li><a href="#regresión-logística" id="toc-regresión-logística" class="nav-link" data-scroll-target="#regresión-logística"><span class="toc-section-number">6.6</span>  Regresión logística</a></li>
  <li><a href="#el-modelo-logístico-aplicado-al-conjunto-de-datos-del-iris." id="toc-el-modelo-logístico-aplicado-al-conjunto-de-datos-del-iris." class="nav-link" data-scroll-target="#el-modelo-logístico-aplicado-al-conjunto-de-datos-del-iris."><span class="toc-section-number">6.7</span>  El modelo logístico aplicado al conjunto de datos del iris.</a></li>
  <li><a href="#clasificación-con-regresión-logística" id="toc-clasificación-con-regresión-logística" class="nav-link" data-scroll-target="#clasificación-con-regresión-logística"><span class="toc-section-number">6.8</span>  Clasificación con regresión logística</a></li>
  <li><a href="#interpretación-de-los-coeficientes-de-una-regresión-logística" id="toc-interpretación-de-los-coeficientes-de-una-regresión-logística" class="nav-link" data-scroll-target="#interpretación-de-los-coeficientes-de-una-regresión-logística"><span class="toc-section-number">6.9</span>  Interpretación de los coeficientes de una regresión logística</a></li>
  <li><a href="#varianza-variable" id="toc-varianza-variable" class="nav-link" data-scroll-target="#varianza-variable"><span class="toc-section-number">6.10</span>  Varianza variable</a></li>
  <li><a href="#regresión-por-cuantiles" id="toc-regresión-por-cuantiles" class="nav-link" data-scroll-target="#regresión-por-cuantiles"><span class="toc-section-number">6.11</span>  Regresión por cuantiles</a></li>
  <li><a href="#regresión-lineal-jerárquica" id="toc-regresión-lineal-jerárquica" class="nav-link" data-scroll-target="#regresión-lineal-jerárquica"><span class="toc-section-number">6.12</span>  Regresión lineal jerárquica</a></li>
  <li><a href="#regresión-lineal-múltiple" id="toc-regresión-lineal-múltiple" class="nav-link" data-scroll-target="#regresión-lineal-múltiple"><span class="toc-section-number">6.13</span>  Regresión lineal múltiple</a></li>
  <li><a href="#ejercicios" id="toc-ejercicios" class="nav-link" data-scroll-target="#ejercicios"><span class="toc-section-number">6.14</span>  Ejercicios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regresión lineal</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p>En más de tres siglos de ciencia todo ha cambiado excepto tal vez una cosa: el amor por lo simple. - Jorge Wagensberg</p>
</blockquote>
<div class="cell" data-execution_count="1">
<details>
<summary>Mostrar Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> preliz <span class="im">as</span> pz</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">from</span> scipy.stats <span class="im">import</span> linregress</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> scipy.special <span class="im">import</span> expit <span class="im">as</span> logistic</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> PchipInterpolator</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">import</span> warnings</span>
<span id="cb1-13"><a href="#cb1-13"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="2">
<details>
<summary>Mostrar Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>plt.style.use(<span class="st">'arviz-doc'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La música, ya sea la Suite para violonchelo N° 1 de Bach, <em>el pibe cantina</em> de damas gratis o Libertango de Piazzolla, se construye con patrones recurrentes. Las mismas escalas, progressiones de acordes, riffs, etc. aparecen una y otra vez dando lugar a un maravilloso paisaje sonoro capaz de provocar y modular toda la gama de emociones humanas. De manera similar, el universo estadístico está compuesto de patrones recurrentes, pequeños motivos que aparecen una y otra vez. En este capítulo, vamos a ver uno de los más populares y útiles de ellos, el modelo lineal. Este es un modelo muy útil en sí mismo y también el componente básico de muchos otros modelos. Es probable que algunos de los siguientes términos te resulten familiares: regresión lineal simple, regresión múltiple, regresión logística, ANOVA, ANCOVA. Todos estos métodos son variaciones del mismo motivo subyacente, el modelo de regresión lineal. En este capítulo, cubriremos los siguientes temas:</p>
<ul>
<li>Regresión lineal simple</li>
<li>Regresión lineal robusta</li>
<li>Regresión jerárquica</li>
<li>Regresión polinomial</li>
<li>Regresión múltiple</li>
<li>Interacciones</li>
<li>Varianza variable</li>
</ul>
<p>Supongamos que tenemos una variable <span class="math inline">\(X\)</span>, y a partir de esta queremos predecir o modelar una variable <span class="math inline">\(Y\)</span>. Además, estás variables se encuentran apareadas <span class="math inline">\(\{(x_1,y_1), (x_2,y_2), \dots (x_n,y_n)\}\)</span>. En el caso más simple <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> son variables aleatorias continuas y unidimensionales, usando un lenguaje de programación, como Python, las representaríamos usando <em>arrays</em> de dimensión 1 y de tipo flotante.</p>
<p>Las variable <span class="math inline">\(Y\)</span> suele recibir distintos nombres como variable dependiente, predicha o respuesta, mientras que <span class="math inline">\(X\)</span> recibe nombres como variable independiente, predictora o <em>de entrada</em>. En <em>Machine learning</em> es común hablar de <em>features</em> en vez de variables y es común pensar que una regresión lineal es un ejemplo de <a href="https://es.wikipedia.org/wiki/Aprendizaje_supervisado">aprendizaje supervisado</a>.</p>
<p>Algunas situaciones típicas en las que se pueden utilizar modelos de regresión lineal:</p>
<ul>
<li><p>Modelar la relación entre la salinidad del suelo y la productividad de los cultivos. Luego, responder preguntas como: ¿Es la relación lineal? ¿Qué tan fuerte es esta relación?</p></li>
<li><p>Encontrar una relación entre el consumo promedio de chocolate por país y el número de premios Nobel en ese país, y luego comprender por qué esta relación es probablemente espuria.</p></li>
<li><p>Predecir la factura de gas de una casa utilizando la radiación solar del informe meteorológico local. ¿Qué tan precisa es esta predicción?</p></li>
</ul>
<section id="la-idea-central-en-regresión-lineal" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="la-idea-central-en-regresión-lineal"><span class="header-section-number">6.1</span> La idea central en regresión lineal</h2>
<p>En un capítulo previo vimos el modelo normal, que (omitiendo las distribuciones a priori) definimos como:</p>
<p><span class="math display">\[
Y \sim \mathcal{N}(\mu, \sigma)
\]</span></p>
<p>La idea central de la regresión lineal es extender este modelo, agregando una variable predictora <span class="math inline">\(X\)</span> a la estimación de la media <span class="math inline">\(\mu\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\mu = \alpha + \beta X \\
Y &amp;\sim \mathcal{N}(\mu, \sigma)
\end{aligned}
\]</span></p>
<p>Este modelo dice que existe una relación lineal entre la variable <span class="math inline">\(X\)</span> y la variable <span class="math inline">\(Y\)</span>. Pero esa relación no es determinista, debido al término de ruido <span class="math inline">\(\sigma\)</span>. Además, el modelo dice que la media de <span class="math inline">\(Y\)</span> es una función lineal de <span class="math inline">\(X\)</span>, con <strong>intercepto</strong> <span class="math inline">\(\alpha\)</span> y <strong>pendiente</strong> <span class="math inline">\(\beta\)</span>. El intercepto nos dice el valor de <span class="math inline">\(Y\)</span> cuando <span class="math inline">\(X=0\)</span>, la pendiente nos dice el cambio en <span class="math inline">\(Y\)</span> por unidad de cambio en <span class="math inline">\(X\)</span>. Debido a que no conocemos los valores de <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> o <span class="math inline">\(\sigma\)</span>, debmos determinar una distribución a priori para estos parámetros.</p>
<p>Una suposición típica cuando se establecen priors para modelos lineales es suponer que son independientes. Esta suposición simplifica enormemente la elección de priors, ya que en vez de definir una dristribución conjunta para los 3 parámetros, podemos definir 3 distribuciones por separado. Al menos en principio, <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span> pueden tomar cualquier valor en los reales, por lo que es común usar a prioris normales para ellos. En cambio <span class="math inline">\(\sigma\)</span> debe ser un número positivo, por lo que es común usar distribuciónes como seminormal, exponencial, gamma-inversa, etc.</p>
<p>Los valores que puede tomar el intercepto pueden variar mucho de un problema a otro. Por ejemplo, yo solía trabajar con problemas donde era esperable que <span class="math inline">\(\alpha\)</span> estuviera alrededor de cero y con una desviación estándar muy por debajo de 1. Pero esta experiencia (casi anecdótica) es dificil de trasladar a cualquier otro problema. Con respecto a la pendiente (<span class="math inline">\(\beta\)</span>), puede ser más fácil tener una noción informada. Usualmente tenemos una idea del signo de la pendiente, por ejemplo esperamos que el peso de un animal aumente, en promedio, con la variable largo (o altura). Para <span class="math inline">\(\sigma\)</span>, podemos establecerlo en un valor grande en la escala de la variable <span class="math inline">\(Y\)</span>, por ejemplo, 2 veces el valor de su desviación estándar. Debemos tener cuidado al usar los datos observados para estimar a prioris, por lo general, está bien si los datos se usan para evitar el uso de a prioris muy restrictivos. Si no tenemos demasiado conocimiento del parámetro, tiene sentido asegurarse que la distribución a priori sea realmente vaga. En cambio, si queremos definir distribuciones a priori más informativas, entonces no deberíamos obtener esa información de los datos observados, sino que deberíamos obtenerla de nuestro conocimiento del dominio.</p>
</section>
<section id="bicicletas-lineales" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="bicicletas-lineales"><span class="header-section-number">6.2</span> Bicicletas lineales</h2>
<p>Ahora que tenemos una idea general de cómo luce un modelo lineal Bayesiano, tratemos de cimentar esta idea con un ejemplo.</p>
<p>Vamos a empezar muy sencillo, tenemos un registro de temperaturas y del número de bicicletas alquiladas en una ciudad. Queremos modelar la relación entre la temperatura y el número de bicicletas alquiladas. Usaremos <a href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset">bike-sharing dataset</a> del repositorio <a href="https://archive.ics.uci.edu/datasets">UCI Machine Learning Repository</a>. El conjunto de datos original contiene 17379 registros, cada registro tiene 17 variables, pero para este ejemplo usaremos tan solo 348 registros y dos variables <code>temperatura</code> y <code>alquiladas</code>. La variable ‘temperatura’ es la temperatura en Celsius y ‘alquiladas’ es el número de bicicletas alquiladas.</p>
<p>Carguemos los datos y grafiquémoslos</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>bicis <span class="op">=</span> pd.read_csv(<span class="st">"datos/bicis.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>bicis.plot(x<span class="op">=</span><span class="st">"temperatura"</span>, y<span class="op">=</span><span class="st">"alquiladas"</span>, kind<span class="op">=</span><span class="st">"scatter"</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Construyamos un modelo lineal bayesiano para estos datos. La temperatura será nuestra variable independiente (nuestra “X”) y el número de bicicletas alquiladas será nuestra variable dependiente (nuestra “Y”). Vamos a utilizar el siguiente modelo:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> modelo_bl:</span>
<span id="cb4-2"><a href="#cb4-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>    σ <span class="op">=</span> pm.HalfCauchy(<span class="st">'σ'</span>, <span class="dv">10</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">'μ'</span>, α <span class="op">+</span> β <span class="op">*</span> bicis.temperatura)</span>
<span id="cb4-6"><a href="#cb4-6"></a>    _ <span class="op">=</span> pm.Normal(<span class="st">'y_pred'</span>, mu<span class="op">=</span>μ, sigma<span class="op">=</span>σ, observed<span class="op">=</span>bicis.alquiladas)</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>pm.model_to_graphviz(modelo_bl)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<p><img src="05_Regresión_lineal_files/figure-html/cell-5-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Antes de calcular la distribución a posteriori tomemos un momento para leer el código línea por línea y asegurarnos de entender lo que está pasando. Comparemos el código con la representación visual del modelo.</p>
<p>Como ya dijimos, este modelo es similar a un modelo normal, la diferenciea principal es que la media se modela como una función lineal de la temperatura. El intercepto es <span class="math inline">\(\alpha\)</span> y la pendiente es <span class="math inline">\(\beta\)</span>. El término de ruido es <span class="math inline">\(\sigma\)</span> y la media es <span class="math inline">\(\mu\)</span>.</p>
<p>Algo importante a notar es que la variable <span class="math inline">\(\mu\)</span> es una variable determinista (<code>pm.Deterministic</code>). Le llamamos así ya que una vez conocidos los valores de <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span>, el valor de <span class="math inline">\(\mu\)</span> queda determinado. En vez que <code>μ = pm.Deterministic('μ', α + β * bikes.temperatura)</code> podríamos haber escrito <code>μ = α + β * bicicletas.temperatura</code> o incluso <code>_ = pm.Normal('y_pred', mu=α + β * bicicletas.temperatura, sigma=ϵ, observado=bicicletas.alquiladas)</code> y el modelo sería el mismo. La única razón de usar <code>pm.Deterministic</code>, es que de esta forma le pedimos a PyMC que guarde los valores de <span class="math inline">\(\mu\)</span> en el InferenceData.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="cf">with</span> modelo_bl:</span>
<span id="cb5-2"><a href="#cb5-2"></a>    idata_bl <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:03&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 3 seconds.</code></pre>
</div>
</div>
<p>Veamos un trace plot de <code>idata_bl</code> combinando todas las cadenas en una sola curva</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>az.plot_trace(idata_bl, combined<span class="op">=</span><span class="va">True</span>)<span class="op">;</span>  </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Algo que suele resultar confuso o inesperado para muchos estudiantes es la gráfica para <span class="math inline">\(\mu\)</span>, por qué hay tantas curvas? Porque a cada observaciones le corresponde una curva, para cáda valor de <span class="math inline">\(X\)</span>, hacemos</p>
<p><span class="math display">\[
\mu_i = \alpha + \beta + x_i
\]</span></p>
<p>Es decir un valor de <span class="math inline">\(\mu\)</span> por cada valor de <span class="math inline">\(X\)</span>, además como <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span> son distribuciones. Entonces cada <span class="math inline">\(\mu_i\)</span> es también una distribución.</p>
<p>Podemos comprobar que hay 348 distribuciones para <span class="math inline">\(\mu\)</span> inspeccionado el InfereceData, por ejemplo:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>cadenas, muestras, mus <span class="op">=</span> idata_bl.posterior[<span class="st">"μ"</span>].shape</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="ss">f"</span><span class="sc">{</span>cadenas<span class="op">=</span><span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>muestras<span class="op">=</span><span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mus<span class="op">=</span><span class="sc">}</span><span class="ss">"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>'cadenas=4, muestras=1000, mus=348'</code></pre>
</div>
</div>
<section id="interpretando-la-media-a-posteriori" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="interpretando-la-media-a-posteriori"><span class="header-section-number">6.2.1</span> Interpretando la media a posteriori</h3>
<p>Habiendo aclarado este punto vamos a focalizarnos en intepretar los parámetros del modelo, pero omitiendo <code>μ</code>. Hagamos un gráfico de las distribuciones a posteriori marginales para <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\sigma\)</span>,</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>az.plot_posterior(idata_bl, var_names<span class="op">=</span>[<span class="st">'~μ'</span>], figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">3</span>))<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Si solo leemos las medias de cada distribución podemos decir que <span class="math inline">\(\mu = 69 + 7,9 X\)</span>. Con esta información podemos decir que el valor esperado de bicicletas alquiladas cuando la temperatura es 0 es de 69 y por cada grado de temperatura el número de bicicletas alquiladas aumenta en 7,9. Así que para una temperatura de 28 grados esperamos alquilar <span class="math inline">\(69 + 7.9 * 28 \approx 278\)</span> bicicletas. Este es nuestro valor esperado, pero la distribución a posteriori también nos informa sobre la incertidumbre en torno a esta estimación. Por ejemplo, el HDI 94% para <span class="math inline">\(\beta\)</span> es (6,1, 9,7), por lo que por cada grado de temperatura el número de bicicletas alquiladas podría aumentar de 6 a unas 10.</p>
<p>Incluso si omitimos la incertidumbre a posteriori, y solo prestaramos atención a las medias, tenemos incertidumbre sobre el número de bicicletas alquiladas debido al valor de <span class="math inline">\(\sigma\)</span> de 170. Entonces, si decimos que para una temperatura de 28 grados, esperamos alquilar 278 bicicletas, no debería sorprendernos que el número real resulte estar entre <span class="math inline">\(\approx 100\)</span> y <span class="math inline">\(\approx 500\)</span> bicicletas.</p>
<p>Ahora vamos a crear algunas gráficas que nos ayudarán a visualizar la incertidumbre combinada de estos parámetros. En una primer lectura recomiendo saltearse el código y focalizarse en las figuras y su interpretación.</p>
<p>La siguiente figura tiene dos paneles. Ambos muestran del número medio de bicicletas alquiladas en función de la temperatura. La diferencia está en como se representa la incertidumbre. Para el panel izquierdo, tomamos 50 muestras de la distribución a posteriori de <span class="math inline">\(\mu\)</span> y las dibujamos como líneas individuales. Para el panel derecho tomamos todas las muestras a posteriori de <span class="math inline">\(\mu\)</span> y las usamos para calcular el HDI 94%.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>posterior <span class="op">=</span> az.extract(idata_bl, num_samples<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a>x_plot <span class="op">=</span> xr.DataArray(np.linspace(bicis.temperatura.<span class="bu">min</span>(), bicis.temperatura.<span class="bu">max</span>(), <span class="dv">50</span>), dims<span class="op">=</span><span class="st">"plot_id"</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>linea_media <span class="op">=</span> posterior[<span class="st">'α'</span>].mean() <span class="op">+</span> posterior[<span class="st">'β'</span>].mean() <span class="op">*</span> x_plot</span>
<span id="cb12-4"><a href="#cb12-4"></a>lineas <span class="op">=</span> posterior[<span class="st">'α'</span>] <span class="op">+</span> posterior[<span class="st">'β'</span>] <span class="op">*</span> x_plot</span>
<span id="cb12-5"><a href="#cb12-5"></a>hdi_lines <span class="op">=</span> az.hdi(idata_bl.posterior[<span class="st">'μ'</span>])</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-9"><a href="#cb12-9"></a>axes[<span class="dv">0</span>].plot(bicis.temperatura, bicis.alquiladas,  <span class="st">'.'</span>, color<span class="op">=</span><span class="st">"0.75"</span>,  zorder<span class="op">=-</span><span class="dv">3</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a>lines_ <span class="op">=</span> axes[<span class="dv">0</span>].plot(x_plot, lineas.T, c<span class="op">=</span><span class="st">'C1'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'lineas'</span>)</span>
<span id="cb12-11"><a href="#cb12-11"></a>plt.setp(lines_[<span class="dv">1</span>:], label<span class="op">=</span><span class="st">"_"</span>)</span>
<span id="cb12-12"><a href="#cb12-12"></a>axes[<span class="dv">0</span>].plot(x_plot, linea_media, c<span class="op">=</span><span class="st">'C0'</span>, label<span class="op">=</span><span class="st">'linea media'</span>)</span>
<span id="cb12-13"><a href="#cb12-13"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'temperatura'</span>)</span>
<span id="cb12-14"><a href="#cb12-14"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'bicis alquiladas'</span>)</span>
<span id="cb12-15"><a href="#cb12-15"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb12-16"><a href="#cb12-16"></a></span>
<span id="cb12-17"><a href="#cb12-17"></a>axes[<span class="dv">1</span>].plot(bicis.temperatura, bicis.alquiladas, <span class="st">'.'</span>, color<span class="op">=</span><span class="st">"0.75"</span>,  zorder<span class="op">=-</span><span class="dv">3</span>)</span>
<span id="cb12-18"><a href="#cb12-18"></a>idx <span class="op">=</span> np.argsort(bicis.temperatura.values)</span>
<span id="cb12-19"><a href="#cb12-19"></a>axes[<span class="dv">1</span>].fill_between(bicis.temperatura[idx], hdi_lines[<span class="st">"μ"</span>][:,<span class="dv">0</span>][idx], hdi_lines[<span class="st">"μ"</span>][:,<span class="dv">1</span>][idx],</span>
<span id="cb12-20"><a href="#cb12-20"></a>                     color<span class="op">=</span><span class="st">"C1"</span>, label<span class="op">=</span><span class="st">'HDI'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb12-21"><a href="#cb12-21"></a>axes[<span class="dv">1</span>].plot(x_plot, linea_media, c<span class="op">=</span><span class="st">'C0'</span>, label<span class="op">=</span><span class="st">'linea media'</span>)</span>
<span id="cb12-22"><a href="#cb12-22"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'temperatura'</span>)</span>
<span id="cb12-23"><a href="#cb12-23"></a>axes[<span class="dv">1</span>].legend()<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ambos paneles transmiten esencialmente la misma información, si volvemos a correr el código para generar el gráfico, las lineas serán diferentes, porque las 50 muestras serán distintas cada vez (salvo que fijemos una semilla). Sin embargo, el área sombreada será la misma, porque estamos utilizando todas las muestras ya calculadas. Si reajustamos el modelo (sin fijar una semillar), no solo obtendremos líneas diferentes, sino que el área sombreada también podría cambiar, pero la diferencia debería ser muy pequeña, caso contrario es probable que necesitemos más muestras (incrementar la candidad de <code>draws</code> en <code>pm.sample(.)</code>)</p>
<p>OK, pero ¿Por qué mostramos dos gráficos ligeramente diferentes si transmiten la misma información? Bueno, por un lado para resaltar que hay diferentes formas de representar la incertidumbre. ¿Cuál es mejor? Como de costumbre, eso depende del contexto, el área sombreada es una buena opción, es muy común y es simple de calcular e interpretar. Pero pueden darse situaciones donde nos interese mostrar muestras individuales de la distribución a posteriori, por ejemplo, la mayoría de las líneas podrían abarcar una determinada región, pero algunas podrían tener una pendiente muy alta. Un área sombreada podría opacar esta información. Al mostrar muestras individuales, puede ser una buena idea animarlas si las está mostrando en una presentación o en un video (ver <a href="http://users.eecs.northwestern.edu/~jhullman/hops_jobs_pfs.pdf">Hypothetical Outcome Plots</a> para obtener más información al respecto).</p>
<p>Otra razón para mostrar estas figuras es que vean diferentes formas de extraer información de la distribución a posteriori. Si prestamos atención al código veremos que en la primera línea usamos <code>az.extract</code> toma la dimensión <code>chain</code> y <code>draw</code> y las apila en una sola dimensión <code>sample</code>, que puede ser útil para el procesamiento posterior. Además, usamos el argumento <code>num_samples</code> para solicitar una submuestra de la distribución a posteriori. Por defecto <code>az.extract</code> opera sobre el grupo <code>posterior</code> de un InferenceData. Si deseamos extraer información de otro grupo, podemos usar el argumento <code>group</code>. En la segunda línea, definimos un DataArray llamado <code>x_plot</code>, con valores igualmente espaciados empezando por la temperatura mínima observada y terminado en la máxima observada. La razón para crear un DataArray es poder usar las capacidades de alineación automática de Xarray (esto lo hacemos en las próximas dos líneas). Si usaramos un arreglo NumPy necesitariamos agregar dimensiones adicionales, lo que puede resultar confuso, la mejor manera de entender completamente lo que quiero decir es definir <code>x_plot = np.linspace(bikes.temperature.min(), bikes.temperature.max())</code> e intentar rehacer el gráfico. En la tercer y cuarta línea de código, calculamos la media del posterior de <span class="math inline">\(\mu\)</span> para cada valor de <code>x_plot</code> las líneas individuales, respectivamente. Podríamos haber usado <code>posterior['μ']</code>, pero en su lugar reescribimos explícitamente el modelo lineal, lo hacemos para ser explícitos y con la esperanza de que te ayude a obtener más intuición sobre los modelos lineales.</p>
</section>
<section id="interpretando-las-predicciones-a-posteriori" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="interpretando-las-predicciones-a-posteriori"><span class="header-section-number">6.2.2</span> Interpretando las predicciones a posteriori</h3>
<p>¿Qué pasa si no solo estamos interesados en el valor esperado (promedio), sino que queremos pensar en términos de predicciones, es decir, en términos de bicicletas alquiladas? Bueno, para eso podemos usar la distribución predictiva a posteriori. Después de ejecutar la siguiente línea de código <code>idata_lb</code> contendrá un nuevo grupo <code>posterior_predictive</code> con una variable <code>y_pred</code> que representa la distribución predictiva a posteriori para el número de bicicletas alquiladas.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>pm.sample_posterior_predictive(idata_bl, model<span class="op">=</span>modelo_bl, extend_inferencedata<span class="op">=</span><span class="va">True</span>, random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling: [y_pred]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="294" class="" max="4000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      7.35% [294/4000 00:00&lt;00:00]
    </div>
    
</div>
<div class="cell-output cell-output-display" data-execution_count="10">


            <div>
              <div class="xr-header">
                <div class="xr-obj-type">arviz.InferenceData</div>
              </div>
              <ul class="xr-sections group-sections">
              
            <li class="xr-section-item">
                  <input id="idata_posterior21f17ef7-a680-4a58-b4b4-43f8831ada7f" class="xr-section-summary-in" type="checkbox">
                  <label for="idata_posterior21f17ef7-a680-4a58-b4b4-43f8831ada7f" class="xr-section-summary">posterior</label>
                  <div class="xr-section-inline-details"></div>
                  <div class="xr-section-details">
                      <ul id="xr-dataset-coord-list" class="xr-var-list">
                          <div style="padding-left:2rem;"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:  (chain: 4, draw: 1000, μ_dim_0: 348)
Coordinates:
  * chain    (chain) int64 0 1 2 3
  * draw     (draw) int64 0 1 2 3 4 5 6 7 8 ... 992 993 994 995 996 997 998 999
  * μ_dim_0  (μ_dim_0) int64 0 1 2 3 4 5 6 7 ... 340 341 342 343 344 345 346 347
Data variables:
    α        (chain, draw) float64 73.42 59.66 105.3 101.8 ... 66.61 54.51 91.06
    β        (chain, draw) float64 7.644 8.523 7.453 6.508 ... 7.588 9.33 6.69
    σ        (chain, draw) float64 158.8 164.1 177.3 177.7 ... 179.7 171.3 169.5
    μ        (chain, draw, μ_dim_0) float64 98.49 69.77 91.31 ... 113.0 144.5
Attributes:
    created_at:                 2023-06-14T19:47:12.763025
    arviz_version:              0.15.1
    inference_library:          pymc
    inference_library_version:  5.3.1
    sampling_time:              3.1656246185302734
    tuning_steps:               1000</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-bd116a7b-a7f6-4bb7-8f6c-406c70611e64" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-bd116a7b-a7f6-4bb7-8f6c-406c70611e64" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">chain</span>: 4</li><li><span class="xr-has-index">draw</span>: 1000</li><li><span class="xr-has-index">μ_dim_0</span>: 348</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-c5735bb8-49a2-4c24-aadb-6d6dbeec80ae" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-c5735bb8-49a2-4c24-aadb-6d6dbeec80ae" class="xr-section-summary">Coordinates: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">chain</span></div><div class="xr-var-dims">(chain)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3</div><input id="attrs-d39aa99d-4fb9-42e9-861b-d49c59c041e4" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-d39aa99d-4fb9-42e9-861b-d49c59c041e4" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3c02b329-6586-46f3-85e8-430f35b4effb" class="xr-var-data-in" type="checkbox"><label for="data-3c02b329-6586-46f3-85e8-430f35b4effb" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([0, 1, 2, 3])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">draw</span></div><div class="xr-var-dims">(draw)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3 4 5 ... 995 996 997 998 999</div><input id="attrs-c759e696-4280-4df3-b0af-bf012b12366e" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-c759e696-4280-4df3-b0af-bf012b12366e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-bf560781-0168-4599-ac3c-9810dc6e490b" class="xr-var-data-in" type="checkbox"><label for="data-bf560781-0168-4599-ac3c-9810dc6e490b" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([  0,   1,   2, ..., 997, 998, 999])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">μ_dim_0</span></div><div class="xr-var-dims">(μ_dim_0)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3 4 5 ... 343 344 345 346 347</div><input id="attrs-48f5863e-c304-474e-8542-5e9c201f32fd" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-48f5863e-c304-474e-8542-5e9c201f32fd" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-75167234-e052-494a-82cb-f81d29619ede" class="xr-var-data-in" type="checkbox"><label for="data-75167234-e052-494a-82cb-f81d29619ede" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([  0,   1,   2, ..., 345, 346, 347])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-136f1782-ae38-45b6-8505-51368af2e17e" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-136f1782-ae38-45b6-8505-51368af2e17e" class="xr-section-summary">Data variables: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>α</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">73.42 59.66 105.3 ... 54.51 91.06</div><input id="attrs-2e42631b-0e2a-48e4-a904-f47c1a15accc" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-2e42631b-0e2a-48e4-a904-f47c1a15accc" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-96e5fada-7123-4c70-8990-8d08eb093546" class="xr-var-data-in" type="checkbox"><label for="data-96e5fada-7123-4c70-8990-8d08eb093546" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[ 73.42493495,  59.66146328, 105.30661831, ...,  86.34407703,
         52.13609249,  46.6912159 ],
       [ 51.07711738,  60.0991086 ,  57.05908282, ...,  64.36408103,
         62.11259321,  79.29587821],
       [ 89.62434939,  38.06868629,  43.45446492, ...,  53.22270313,
         52.63631534,  49.41615315],
       [ 85.43886153,  74.92029525,  93.92565962, ...,  66.60543029,
         54.50932903,  91.05801517]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>β</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.644 8.523 7.453 ... 9.33 6.69</div><input id="attrs-b5134239-14d0-414f-a2dc-a25e4d90f9d5" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-b5134239-14d0-414f-a2dc-a25e4d90f9d5" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-08937eb2-46b6-4e5f-bb0d-7ea5a183a42c" class="xr-var-data-in" type="checkbox"><label for="data-08937eb2-46b6-4e5f-bb0d-7ea5a183a42c" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[ 7.64371429,  8.52294793,  7.45278168, ...,  6.64794795,
         8.66049442,  8.89524135],
       [ 9.13508929,  9.17475969,  7.85022692, ...,  8.74030562,
         7.66118314,  7.9627473 ],
       [ 6.69511288,  9.32164185,  8.7747248 , ...,  9.27577966,
        10.19153659,  9.70369026],
       [ 7.48102715,  7.13436707,  6.48973363, ...,  7.58828659,
         9.33015254,  6.69023439]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>σ</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">158.8 164.1 177.3 ... 171.3 169.5</div><input id="attrs-f2aa05a2-fd35-4d52-bb61-a5abc28ff8ff" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-f2aa05a2-fd35-4d52-bb61-a5abc28ff8ff" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c09af0c7-d519-4b7c-9ff0-99606496a0e7" class="xr-var-data-in" type="checkbox"><label for="data-c09af0c7-d519-4b7c-9ff0-99606496a0e7" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[158.82715774, 164.07548464, 177.32797301, ..., 162.66349201,
        171.82795902, 162.15154898],
       [164.28367687, 163.81114793, 174.88247442, ..., 172.19881704,
        173.36118572, 169.56808389],
       [166.38825808, 172.10488338, 162.33551845, ..., 182.2517708 ,
        184.45444216, 184.70103686],
       [167.23414142, 166.51661423, 171.89238525, ..., 179.74754127,
        171.30089775, 169.47478241]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>μ</span></div><div class="xr-var-dims">(chain, draw, μ_dim_0)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">98.49 69.77 91.31 ... 113.0 144.5</div><input id="attrs-71b72ac7-f292-4a48-9e74-e0b07e5d511f" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-71b72ac7-f292-4a48-9e74-e0b07e5d511f" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e5270c15-fdf9-4776-a83f-22fdcca68d93" class="xr-var-data-in" type="checkbox"><label for="data-e5270c15-fdf9-4776-a83f-22fdcca68d93" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[[ 98.48836712,  69.7690919 ,  91.3087509 , ..., 105.68065948,
          98.48461903, 134.4299879 ],
        [ 87.60786724,  55.58509951,  79.6024012 , ...,  95.62746752,
          87.60368801, 127.68374538],
        [129.74399011, 101.74209469, 122.74371378, ..., 136.75662594,
         129.74033564, 164.78782387],
        ...,
        [108.14243135,  83.16449007, 101.89812223, ..., 114.39776526,
         108.13917153, 139.40184464],
        [ 80.53350587,  47.99394286,  72.39884466, ...,  88.68252944,
          80.5292592 , 121.25614339],
        [ 75.85835504,  42.43679128,  67.50319985, ...,  84.22826186,
          75.85399325, 117.68479952]],

       [[ 81.03070826,  46.70797806,  72.45026782, ...,  89.6262981 ,
          81.02622887, 123.98494522],
        [ 90.18277713,  55.71099567,  81.56507493, ...,  98.81569452,
          90.17827829, 133.32354887],
        [ 82.79966159,  53.30446871,  75.42607143, ...,  90.18627036,
          82.79581223, 119.7123284 ],
...
        [ 83.63761211,  48.78627428,  74.92502349, ...,  92.36558344,
          83.63306373, 127.25339135],
        [ 86.0539545 ,  47.76189738,  76.48121033, ...,  95.64360005,
          86.04895708, 133.9757278 ],
        [ 81.23416378,  44.7750628 ,  72.11964572, ...,  90.3647742 ,
          81.22940558, 126.8620277 ]],

       [[109.96884911,  81.86082865, 102.94204227, ..., 117.0080623 ,
         109.96518079, 145.14549633],
        [ 98.31359835,  71.50806328,  91.61240367, ..., 105.02662448,
          98.31010001, 131.86021013],
        [115.20523554,  90.82174356, 109.10953455, ..., 121.31169894,
         115.2020533 , 145.72070696],
        ...,
        [ 91.48711725,  62.97609726,  84.35956337, ...,  98.62725535,
          91.48339633, 127.16811062],
        [ 85.10252448,  50.04689466,  76.33886431, ...,  93.88165754,
          85.09794944, 128.97397123],
        [112.99502503,  87.85820341, 106.71099694, ..., 119.29014803,
         112.99174447, 144.453274  ]]])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-6f47584b-61a4-475f-bb33-40eb907d9322" class="xr-section-summary-in" type="checkbox"><label for="section-6f47584b-61a4-475f-bb33-40eb907d9322" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>chain</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-2c37fe13-415c-4574-b3b6-8f994940375c" class="xr-index-data-in" type="checkbox"><label for="index-2c37fe13-415c-4574-b3b6-8f994940375c" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([0, 1, 2, 3], dtype='int64', name='chain'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>draw</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-d2edbd3b-6907-4c14-b3c0-5bdac61f031b" class="xr-index-data-in" type="checkbox"><label for="index-d2edbd3b-6907-4c14-b3c0-5bdac61f031b" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
       ...
       990, 991, 992, 993, 994, 995, 996, 997, 998, 999],
      dtype='int64', name='draw', length=1000))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>μ_dim_0</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-6cc33d4e-f555-4445-bf79-158ced318fdb" class="xr-index-data-in" type="checkbox"><label for="index-6cc33d4e-f555-4445-bf79-158ced318fdb" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
       ...
       338, 339, 340, 341, 342, 343, 344, 345, 346, 347],
      dtype='int64', name='μ_dim_0', length=348))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-77a5f8e0-c048-4b17-8627-56ce4a716182" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-77a5f8e0-c048-4b17-8627-56ce4a716182" class="xr-section-summary">Attributes: <span>(6)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>created_at :</span></dt><dd>2023-06-14T19:47:12.763025</dd><dt><span>arviz_version :</span></dt><dd>0.15.1</dd><dt><span>inference_library :</span></dt><dd>pymc</dd><dt><span>inference_library_version :</span></dt><dd>5.3.1</dd><dt><span>sampling_time :</span></dt><dd>3.1656246185302734</dd><dt><span>tuning_steps :</span></dt><dd>1000</dd></dl></div></li></ul></div></div><br></div>
                      </ul>
                  </div>
            </li>
            
            <li class="xr-section-item">
                  <input id="idata_posterior_predictive0c8534f9-f430-4a9f-ae12-2f216441e2f1" class="xr-section-summary-in" type="checkbox">
                  <label for="idata_posterior_predictive0c8534f9-f430-4a9f-ae12-2f216441e2f1" class="xr-section-summary">posterior_predictive</label>
                  <div class="xr-section-inline-details"></div>
                  <div class="xr-section-details">
                      <ul id="xr-dataset-coord-list" class="xr-var-list">
                          <div style="padding-left:2rem;"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:       (chain: 4, draw: 1000, y_pred_dim_2: 348)
Coordinates:
  * chain         (chain) int64 0 1 2 3
  * draw          (draw) int64 0 1 2 3 4 5 6 7 ... 993 994 995 996 997 998 999
  * y_pred_dim_2  (y_pred_dim_2) int64 0 1 2 3 4 5 6 ... 342 343 344 345 346 347
Data variables:
    y_pred        (chain, draw, y_pred_dim_2) float64 6.174 62.22 ... 156.2
Attributes:
    created_at:                 2023-06-14T19:47:24.995345
    arviz_version:              0.15.1
    inference_library:          pymc
    inference_library_version:  5.3.1</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-9a350a4c-5be2-4fad-bad0-d9bb1f9579f4" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-9a350a4c-5be2-4fad-bad0-d9bb1f9579f4" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">chain</span>: 4</li><li><span class="xr-has-index">draw</span>: 1000</li><li><span class="xr-has-index">y_pred_dim_2</span>: 348</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-c1b799a4-42ac-4da2-9b29-94dbcc08da59" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-c1b799a4-42ac-4da2-9b29-94dbcc08da59" class="xr-section-summary">Coordinates: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">chain</span></div><div class="xr-var-dims">(chain)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3</div><input id="attrs-0069a9c4-7b50-4c3c-b31e-84fc358195e1" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-0069a9c4-7b50-4c3c-b31e-84fc358195e1" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-0835a669-438e-48a9-be2d-3c75e1f084ba" class="xr-var-data-in" type="checkbox"><label for="data-0835a669-438e-48a9-be2d-3c75e1f084ba" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([0, 1, 2, 3])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">draw</span></div><div class="xr-var-dims">(draw)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3 4 5 ... 995 996 997 998 999</div><input id="attrs-e5811fd5-d76d-4049-aa3c-c5049c6d429c" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-e5811fd5-d76d-4049-aa3c-c5049c6d429c" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-89260f59-afa1-4337-81a9-7a49b58831ef" class="xr-var-data-in" type="checkbox"><label for="data-89260f59-afa1-4337-81a9-7a49b58831ef" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([  0,   1,   2, ..., 997, 998, 999])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y_pred_dim_2</span></div><div class="xr-var-dims">(y_pred_dim_2)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3 4 5 ... 343 344 345 346 347</div><input id="attrs-1a07aa0b-1139-4437-9edc-d2088b5c9d49" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-1a07aa0b-1139-4437-9edc-d2088b5c9d49" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3ce403a5-a362-4c6f-86cc-5c1dc5d92da9" class="xr-var-data-in" type="checkbox"><label for="data-3ce403a5-a362-4c6f-86cc-5c1dc5d92da9" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([  0,   1,   2, ..., 345, 346, 347])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-692e71b6-3795-49a2-b676-cb681be07970" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-692e71b6-3795-49a2-b676-cb681be07970" class="xr-section-summary">Data variables: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>y_pred</span></div><div class="xr-var-dims">(chain, draw, y_pred_dim_2)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">6.174 62.22 73.61 ... 193.0 156.2</div><input id="attrs-68eb286c-611d-4fba-89d3-f4b1874ce572" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-68eb286c-611d-4fba-89d3-f4b1874ce572" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3d338a40-3bed-430e-ac2b-bdafd87218eb" class="xr-var-data-in" type="checkbox"><label for="data-3d338a40-3bed-430e-ac2b-bdafd87218eb" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[[ 6.17429192e+00,  6.22249250e+01,  7.36071372e+01, ...,
          3.66116209e+02,  3.21016884e+02, -1.55095665e+01],
        [ 1.57985181e+02,  1.18344250e+02,  3.57522893e+02, ...,
          1.55553781e+02, -1.98740334e+01,  1.03411892e+02],
        [ 1.16618879e+02, -2.87161476e+02,  3.29840411e+02, ...,
         -2.36543190e+02, -8.36251491e+01,  1.34242950e+02],
        ...,
        [ 2.00591625e+02, -1.71329029e+02,  2.36808023e+02, ...,
          2.15565513e+02,  3.48362992e+02,  3.28741934e+02],
        [-1.52911744e+02,  6.19037587e+01,  1.21205762e+02, ...,
         -2.60563711e+02, -9.64138839e+01,  2.67628322e+02],
        [ 1.07211963e+01, -5.09611875e+01,  7.06390120e+01, ...,
          2.56060957e+02, -9.33413781e+01, -1.60039621e+02]],

       [[ 2.69620570e+01,  9.82230442e+01,  2.91179564e+02, ...,
         -4.47706729e+01,  3.19796072e+02,  6.81870722e+01],
        [-1.44902240e+02, -6.26351731e+00,  1.40180035e+02, ...,
          9.49711833e+01,  2.49392219e+02,  4.66466817e+01],
        [ 2.43567605e+02,  1.49061140e+02,  2.20036929e+01, ...,
          1.38445537e+02, -2.59101858e+02,  9.72412084e+01],
...
        [-1.41683236e+02,  8.52987334e+01, -1.14967307e+02, ...,
          3.43634762e+02,  1.99393450e+02,  3.35325405e+02],
        [ 3.62409432e+02,  1.90336927e+02,  2.99038249e+02, ...,
         -9.27488017e+01, -2.71075279e+01,  5.61122509e+01],
        [-3.18469351e+01,  2.81360695e+01, -1.81039148e+02, ...,
          2.96879231e+02,  2.17329779e+02,  3.19208699e+02]],

       [[ 2.29923571e+02, -1.79313136e+00,  6.29007694e+01, ...,
          5.56380457e+01, -1.41896443e+02,  1.72866939e+02],
        [ 2.41295969e+02,  1.78910388e+01, -4.95076962e+01, ...,
          2.10784800e+02,  4.10754508e+01, -2.49498879e+02],
        [ 1.50508044e+01,  7.44277610e+01,  3.00592699e+02, ...,
          1.66167430e+02, -1.43379849e+01, -7.14110213e+01],
        ...,
        [ 1.63996374e+02, -2.79235955e+01,  1.11918791e+02, ...,
          1.34986203e+02,  6.40185848e+01,  4.52309060e+01],
        [ 3.28772684e+02, -1.02767332e+01,  6.27130964e+01, ...,
          1.24291374e+02, -4.86968456e+01,  1.26289542e+02],
        [ 8.45411950e+01,  8.72467596e+00, -1.88172642e+02, ...,
          4.28097235e+02,  1.93045122e+02,  1.56209180e+02]]])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-37d74946-7240-40b3-b45f-4ee59816618e" class="xr-section-summary-in" type="checkbox"><label for="section-37d74946-7240-40b3-b45f-4ee59816618e" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>chain</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-73d3e513-bba1-4dfc-a6be-754f2a3d8d2d" class="xr-index-data-in" type="checkbox"><label for="index-73d3e513-bba1-4dfc-a6be-754f2a3d8d2d" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([0, 1, 2, 3], dtype='int64', name='chain'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>draw</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-854d8de0-1dcf-4d83-b14e-8d694bc85638" class="xr-index-data-in" type="checkbox"><label for="index-854d8de0-1dcf-4d83-b14e-8d694bc85638" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
       ...
       990, 991, 992, 993, 994, 995, 996, 997, 998, 999],
      dtype='int64', name='draw', length=1000))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y_pred_dim_2</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-e5dd4224-d3f8-42ce-9854-3e008ccd17e3" class="xr-index-data-in" type="checkbox"><label for="index-e5dd4224-d3f8-42ce-9854-3e008ccd17e3" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
       ...
       338, 339, 340, 341, 342, 343, 344, 345, 346, 347],
      dtype='int64', name='y_pred_dim_2', length=348))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-d1771648-3d30-4072-9feb-7801b57bfc8f" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-d1771648-3d30-4072-9feb-7801b57bfc8f" class="xr-section-summary">Attributes: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>created_at :</span></dt><dd>2023-06-14T19:47:24.995345</dd><dt><span>arviz_version :</span></dt><dd>0.15.1</dd><dt><span>inference_library :</span></dt><dd>pymc</dd><dt><span>inference_library_version :</span></dt><dd>5.3.1</dd></dl></div></li></ul></div></div><br></div>
                      </ul>
                  </div>
            </li>
            
            <li class="xr-section-item">
                  <input id="idata_sample_stats4b826102-ce5b-494c-8446-230a004f4d86" class="xr-section-summary-in" type="checkbox">
                  <label for="idata_sample_stats4b826102-ce5b-494c-8446-230a004f4d86" class="xr-section-summary">sample_stats</label>
                  <div class="xr-section-inline-details"></div>
                  <div class="xr-section-details">
                      <ul id="xr-dataset-coord-list" class="xr-var-list">
                          <div style="padding-left:2rem;"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:                (chain: 4, draw: 1000)
Coordinates:
  * chain                  (chain) int64 0 1 2 3
  * draw                   (draw) int64 0 1 2 3 4 5 ... 994 995 996 997 998 999
Data variables: (12/17)
    smallest_eigval        (chain, draw) float64 nan nan nan nan ... nan nan nan
    energy                 (chain, draw) float64 2.292e+03 ... 2.293e+03
    index_in_trajectory    (chain, draw) int64 -2 2 5 -1 -2 4 ... -3 3 4 -2 -4 5
    process_time_diff      (chain, draw) float64 0.000445 ... 0.0005429
    perf_counter_start     (chain, draw) float64 2.499e+04 ... 2.499e+04
    max_energy_error       (chain, draw) float64 0.08135 -0.06315 ... 0.3578
    ...                     ...
    n_steps                (chain, draw) float64 3.0 7.0 7.0 3.0 ... 7.0 7.0 7.0
    acceptance_rate        (chain, draw) float64 0.9538 0.9985 ... 0.7794 0.8962
    perf_counter_diff      (chain, draw) float64 0.0004448 ... 0.0005429
    largest_eigval         (chain, draw) float64 nan nan nan nan ... nan nan nan
    energy_error           (chain, draw) float64 0.06236 -0.06208 ... -0.2526
    reached_max_treedepth  (chain, draw) bool False False False ... False False
Attributes:
    created_at:                 2023-06-14T19:47:12.772411
    arviz_version:              0.15.1
    inference_library:          pymc
    inference_library_version:  5.3.1
    sampling_time:              3.1656246185302734
    tuning_steps:               1000</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-5ecd1f76-7cd2-47e8-aa81-a28d84cfdf99" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-5ecd1f76-7cd2-47e8-aa81-a28d84cfdf99" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">chain</span>: 4</li><li><span class="xr-has-index">draw</span>: 1000</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-af9af404-c0fb-479b-8b96-f54157ba2797" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-af9af404-c0fb-479b-8b96-f54157ba2797" class="xr-section-summary">Coordinates: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">chain</span></div><div class="xr-var-dims">(chain)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3</div><input id="attrs-1843e997-2cb5-4165-abfe-33e2ab1970d5" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-1843e997-2cb5-4165-abfe-33e2ab1970d5" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-cd2ce878-18dc-4f61-b51d-bdbfce3570c1" class="xr-var-data-in" type="checkbox"><label for="data-cd2ce878-18dc-4f61-b51d-bdbfce3570c1" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([0, 1, 2, 3])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">draw</span></div><div class="xr-var-dims">(draw)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3 4 5 ... 995 996 997 998 999</div><input id="attrs-1d0a01d9-a2c1-4862-adbf-872cff9f9e70" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-1d0a01d9-a2c1-4862-adbf-872cff9f9e70" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-815cee66-ee2e-4697-9d87-0328e916a6e1" class="xr-var-data-in" type="checkbox"><label for="data-815cee66-ee2e-4697-9d87-0328e916a6e1" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([  0,   1,   2, ..., 997, 998, 999])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-4b2d7195-6e10-4185-96f3-8e5ad8340d25" class="xr-section-summary-in" type="checkbox"><label for="section-4b2d7195-6e10-4185-96f3-8e5ad8340d25" class="xr-section-summary">Data variables: <span>(17)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>smallest_eigval</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">nan nan nan nan ... nan nan nan nan</div><input id="attrs-91c8c833-4a60-47a1-a7bd-6921f35a3373" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-91c8c833-4a60-47a1-a7bd-6921f35a3373" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-4473af85-b527-4bb2-8beb-dbecf2697507" class="xr-var-data-in" type="checkbox"><label for="data-4473af85-b527-4bb2-8beb-dbecf2697507" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>energy</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">2.292e+03 2.293e+03 ... 2.293e+03</div><input id="attrs-31c92dea-738c-42f7-8818-7ab273a5b122" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-31c92dea-738c-42f7-8818-7ab273a5b122" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-90ec035f-fdea-4ca3-bf58-16deab95c4d6" class="xr-var-data-in" type="checkbox"><label for="data-90ec035f-fdea-4ca3-bf58-16deab95c4d6" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[2292.38465229, 2292.87857743, 2296.83507411, ..., 2293.18134085,
        2293.46476754, 2293.45301363],
       [2292.72643713, 2293.24223652, 2293.91795788, ..., 2292.89153382,
        2293.16993969, 2292.45660984],
       [2293.53792431, 2293.841904  , 2294.87522651, ..., 2296.67502416,
        2298.25521888, 2297.20715421],
       [2292.92607978, 2292.00036353, 2295.95017591, ..., 2294.56324392,
        2295.15392614, 2293.31094089]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>index_in_trajectory</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">-2 2 5 -1 -2 4 ... -3 3 4 -2 -4 5</div><input id="attrs-b1932a12-f735-4ff0-9f3c-b69da11d7785" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-b1932a12-f735-4ff0-9f3c-b69da11d7785" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-810e9976-69f4-4820-ab47-2501f9c0966a" class="xr-var-data-in" type="checkbox"><label for="data-810e9976-69f4-4820-ab47-2501f9c0966a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[-2,  2,  5, ..., -4, -3,  4],
       [-2, -1, -6, ...,  3,  2, -2],
       [ 4,  6, -4, ...,  2,  1, -1],
       [-3, -1,  1, ..., -2, -4,  5]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>process_time_diff</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.000445 0.0006886 ... 0.0005429</div><input id="attrs-fe574c42-09c6-4179-abc6-44f9e69355b6" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-fe574c42-09c6-4179-abc6-44f9e69355b6" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-eb1d8ab9-1bff-44da-b377-bac671abf1e2" class="xr-var-data-in" type="checkbox"><label for="data-eb1d8ab9-1bff-44da-b377-bac671abf1e2" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[0.00044496, 0.00068857, 0.00067229, ..., 0.00063633, 0.00063186,
        0.00128031],
       [0.00046821, 0.00063233, 0.00103732, ..., 0.00058068, 0.00112002,
        0.00058488],
       [0.00069321, 0.00066953, 0.00071448, ..., 0.0003417 , 0.00033897,
        0.00076204],
       [0.00084621, 0.00036101, 0.00070714, ..., 0.00057203, 0.00054977,
        0.00054292]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>perf_counter_start</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">2.499e+04 2.499e+04 ... 2.499e+04</div><input id="attrs-ebb56562-50ca-410c-a9d4-5f76c6b47048" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-ebb56562-50ca-410c-a9d4-5f76c6b47048" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-13f066e8-f2cb-4fd6-a8ab-e33fe2a05c38" class="xr-var-data-in" type="checkbox"><label for="data-13f066e8-f2cb-4fd6-a8ab-e33fe2a05c38" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[24985.47780454, 24985.47853234, 24985.47930832, ...,
        24986.44330516, 24986.44403722, 24986.44474768],
       [24985.29355114, 24985.29430276, 24985.29504159, ...,
        24986.26302622, 24986.26405341, 24986.26530755],
       [24985.41262598, 24985.41341522, 24985.41417183, ...,
        24986.23957287, 24986.2399961 , 24986.24041476],
       [24985.53120626, 24985.53216995, 24985.53261914, ...,
        24986.58293694, 24986.58357949, 24986.58419572]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>max_energy_error</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.08135 -0.06315 ... 0.7102 0.3578</div><input id="attrs-34057e4a-e01f-402c-82c3-5b46a42466dc" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-34057e4a-e01f-402c-82c3-5b46a42466dc" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-846c7c78-f869-4c1f-9438-cf2529adc3e3" class="xr-var-data-in" type="checkbox"><label for="data-846c7c78-f869-4c1f-9438-cf2529adc3e3" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[ 0.08135002, -0.06314573,  2.65701788, ..., -0.08585883,
        -0.09571448,  0.52633044],
       [ 0.16019574,  0.5271793 , -0.58674622, ...,  0.25821806,
         0.68699359, -0.0957667 ],
       [ 0.19397877,  1.42807737,  0.27717663, ...,  1.21665203,
         1.15620248, -1.56591606],
       [ 0.22721783,  0.07821551, -0.17150318, ..., -0.20146886,
         0.71023613,  0.35783961]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>step_size_bar</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.5271 0.5271 ... 0.5269 0.5269</div><input id="attrs-ffaf4706-cb31-4508-bc9b-34886e32cbbd" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-ffaf4706-cb31-4508-bc9b-34886e32cbbd" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-57a31c8e-e8c9-4c16-bb8b-4c3037a71e42" class="xr-var-data-in" type="checkbox"><label for="data-57a31c8e-e8c9-4c16-bb8b-4c3037a71e42" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[0.52706571, 0.52706571, 0.52706571, ..., 0.52706571, 0.52706571,
        0.52706571],
       [0.61751936, 0.61751936, 0.61751936, ..., 0.61751936, 0.61751936,
        0.61751936],
       [0.52500971, 0.52500971, 0.52500971, ..., 0.52500971, 0.52500971,
        0.52500971],
       [0.52687759, 0.52687759, 0.52687759, ..., 0.52687759, 0.52687759,
        0.52687759]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>lp</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-2.292e+03 ... -2.292e+03</div><input id="attrs-aa7d38cb-ed57-4dba-af95-e1ac7bcde21a" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-aa7d38cb-ed57-4dba-af95-e1ac7bcde21a" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-a0969470-1f37-4ef4-807a-f053eee4b35e" class="xr-var-data-in" type="checkbox"><label for="data-a0969470-1f37-4ef4-807a-f053eee4b35e" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[-2292.31218358, -2291.46251508, -2296.66232091, ...,
        -2292.38811041, -2291.61891404, -2292.47256581],
       [-2292.05909703, -2292.82904493, -2292.48827727, ...,
        -2291.86093814, -2292.03634414, -2291.71536542],
       [-2291.87548445, -2292.72076885, -2293.00496567, ...,
        -2294.00524692, -2297.70072343, -2295.47763832],
       [-2291.68012935, -2291.64101552, -2292.21666314, ...,
        -2292.77661558, -2292.40257033, -2291.84911534]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>step_size</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.4355 0.4355 ... 0.5838 0.5838</div><input id="attrs-451ed9c2-7405-4755-add2-bfb62dc09d3d" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-451ed9c2-7405-4755-add2-bfb62dc09d3d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-dcfbc1fc-58f6-4f26-9cbd-2174d2f41d69" class="xr-var-data-in" type="checkbox"><label for="data-dcfbc1fc-58f6-4f26-9cbd-2174d2f41d69" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[0.43553391, 0.43553391, 0.43553391, ..., 0.43553391, 0.43553391,
        0.43553391],
       [0.43077189, 0.43077189, 0.43077189, ..., 0.43077189, 0.43077189,
        0.43077189],
       [0.42874467, 0.42874467, 0.42874467, ..., 0.42874467, 0.42874467,
        0.42874467],
       [0.58379123, 0.58379123, 0.58379123, ..., 0.58379123, 0.58379123,
        0.58379123]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>diverging</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">bool</div><div class="xr-var-preview xr-preview">False False False ... False False</div><input id="attrs-52a29b95-ef6a-495d-9984-4730ea14f9e3" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-52a29b95-ef6a-495d-9984-4730ea14f9e3" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-aaf73786-30d1-4551-afba-6351e323518e" class="xr-var-data-in" type="checkbox"><label for="data-aaf73786-30d1-4551-afba-6351e323518e" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>tree_depth</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">2 3 3 2 2 3 2 2 ... 2 3 3 3 3 3 3 3</div><input id="attrs-f5a55df3-560b-4f90-b719-7dde010f0b9a" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-f5a55df3-560b-4f90-b719-7dde010f0b9a" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-632ea0b3-7f7a-48ce-bfec-1bc2722cf0df" class="xr-var-data-in" type="checkbox"><label for="data-632ea0b3-7f7a-48ce-bfec-1bc2722cf0df" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[2, 3, 3, ..., 3, 3, 4],
       [2, 2, 3, ..., 2, 3, 2],
       [3, 3, 3, ..., 2, 2, 3],
       [3, 2, 3, ..., 3, 3, 3]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>n_steps</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">3.0 7.0 7.0 3.0 ... 7.0 7.0 7.0 7.0</div><input id="attrs-00bc9b60-679a-45e0-9d84-8369dfceb325" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-00bc9b60-679a-45e0-9d84-8369dfceb325" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-238e8c03-0145-4476-9f5f-ac384cef115c" class="xr-var-data-in" type="checkbox"><label for="data-238e8c03-0145-4476-9f5f-ac384cef115c" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[ 3.,  7.,  7., ...,  7.,  7., 15.],
       [ 3.,  3.,  7., ...,  3.,  7.,  3.],
       [ 7.,  7.,  7., ...,  3.,  3.,  7.],
       [ 7.,  3.,  7., ...,  7.,  7.,  7.]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acceptance_rate</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.9538 0.9985 ... 0.7794 0.8962</div><input id="attrs-0e68fe78-712c-4e3b-b637-d7b1e1f75384" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-0e68fe78-712c-4e3b-b637-d7b1e1f75384" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-d7042269-4855-4cfe-ad27-34959fed0049" class="xr-var-data-in" type="checkbox"><label for="data-d7042269-4855-4cfe-ad27-34959fed0049" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[0.95380647, 0.99852501, 0.40836033, ..., 0.9863736 , 0.99085177,
        0.79584152],
       [0.92006504, 0.71966705, 1.        , ..., 0.86995056, 0.70726883,
        0.95957316],
       [0.92146427, 0.52071409, 0.88501896, ..., 0.5674322 , 0.56543205,
        0.98237713],
       [0.91279773, 0.95056309, 0.95711029, ..., 0.96283568, 0.7793867 ,
        0.89617318]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>perf_counter_diff</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.0004448 0.0006885 ... 0.0005429</div><input id="attrs-7e0f446f-c518-428f-bcee-119cdca18b64" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-7e0f446f-c518-428f-bcee-119cdca18b64" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-ba91ed47-4a1a-48d6-b3b2-2c86b8b78ed7" class="xr-var-data-in" type="checkbox"><label for="data-ba91ed47-4a1a-48d6-b3b2-2c86b8b78ed7" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[0.00044481, 0.00068853, 0.00067224, ..., 0.00063626, 0.00063183,
        0.0012801 ],
       [0.00046195, 0.00063219, 0.00103695, ..., 0.00058062, 0.00111995,
        0.00058472],
       [0.00069318, 0.00066944, 0.00071417, ..., 0.00034179, 0.00033905,
        0.00076165],
       [0.00085962, 0.0003611 , 0.0007068 , ..., 0.00057186, 0.00054972,
        0.00054291]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>largest_eigval</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">nan nan nan nan ... nan nan nan nan</div><input id="attrs-9310fdaa-0c93-4bef-999f-5269a5fb8b4d" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-9310fdaa-0c93-4bef-999f-5269a5fb8b4d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-7fe6310a-468f-49e1-a108-273df17b8c27" class="xr-var-data-in" type="checkbox"><label for="data-7fe6310a-468f-49e1-a108-273df17b8c27" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>energy_error</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.06236 -0.06208 ... -0.2526</div><input id="attrs-0b37b8f9-1bda-4e0f-8c4e-1f2215e70efb" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-0b37b8f9-1bda-4e0f-8c4e-1f2215e70efb" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-9355025a-b3aa-4413-a53e-fee349ab6563" class="xr-var-data-in" type="checkbox"><label for="data-9355025a-b3aa-4413-a53e-fee349ab6563" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[ 0.0623559 , -0.06208129,  2.13462506, ...,  0.04302744,
        -0.079441  ,  0.04188887],
       [ 0.00240051,  0.52532953, -0.06526068, ...,  0.16843362,
         0.13962037, -0.0957667 ],
       [-0.10119859,  0.21952694,  0.27717663, ..., -0.29848284,
         1.15620248, -0.93007826],
       [ 0.12564641, -0.00828786, -0.12476424, ...,  0.01490099,
        -0.02458915, -0.25263189]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>reached_max_treedepth</span></div><div class="xr-var-dims">(chain, draw)</div><div class="xr-var-dtype">bool</div><div class="xr-var-preview xr-preview">False False False ... False False</div><input id="attrs-5383b70e-502a-451a-a123-e2910ed99651" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-5383b70e-502a-451a-a123-e2910ed99651" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3792c5b1-b9c8-42ba-a347-400f264f4d06" class="xr-var-data-in" type="checkbox"><label for="data-3792c5b1-b9c8-42ba-a347-400f264f4d06" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([[False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False]])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-102637b3-8ef3-4def-9d99-045e05b98357" class="xr-section-summary-in" type="checkbox"><label for="section-102637b3-8ef3-4def-9d99-045e05b98357" class="xr-section-summary">Indexes: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>chain</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-3c1f948a-8f6d-4408-8c95-411af6cd469f" class="xr-index-data-in" type="checkbox"><label for="index-3c1f948a-8f6d-4408-8c95-411af6cd469f" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([0, 1, 2, 3], dtype='int64', name='chain'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>draw</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-f3f646ec-c166-4c5a-9344-789729d3f542" class="xr-index-data-in" type="checkbox"><label for="index-f3f646ec-c166-4c5a-9344-789729d3f542" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
       ...
       990, 991, 992, 993, 994, 995, 996, 997, 998, 999],
      dtype='int64', name='draw', length=1000))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-820051a9-c72a-4a50-90d4-af924e1a8e7e" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-820051a9-c72a-4a50-90d4-af924e1a8e7e" class="xr-section-summary">Attributes: <span>(6)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>created_at :</span></dt><dd>2023-06-14T19:47:12.772411</dd><dt><span>arviz_version :</span></dt><dd>0.15.1</dd><dt><span>inference_library :</span></dt><dd>pymc</dd><dt><span>inference_library_version :</span></dt><dd>5.3.1</dd><dt><span>sampling_time :</span></dt><dd>3.1656246185302734</dd><dt><span>tuning_steps :</span></dt><dd>1000</dd></dl></div></li></ul></div></div><br></div>
                      </ul>
                  </div>
            </li>
            
            <li class="xr-section-item">
                  <input id="idata_observed_data484deb3f-3af6-445a-a9fb-5a14c84499c5" class="xr-section-summary-in" type="checkbox">
                  <label for="idata_observed_data484deb3f-3af6-445a-a9fb-5a14c84499c5" class="xr-section-summary">observed_data</label>
                  <div class="xr-section-inline-details"></div>
                  <div class="xr-section-details">
                      <ul id="xr-dataset-coord-list" class="xr-var-list">
                          <div style="padding-left:2rem;"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:       (y_pred_dim_0: 348)
Coordinates:
  * y_pred_dim_0  (y_pred_dim_0) int64 0 1 2 3 4 5 6 ... 342 343 344 345 346 347
Data variables:
    y_pred        (y_pred_dim_0) float64 16.0 3.0 115.0 ... 13.0 271.0 102.0
Attributes:
    created_at:                 2023-06-14T19:47:12.775956
    arviz_version:              0.15.1
    inference_library:          pymc
    inference_library_version:  5.3.1</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-36116705-a537-4ee3-8e27-76eb877268d8" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-36116705-a537-4ee3-8e27-76eb877268d8" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">y_pred_dim_0</span>: 348</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-61ce844b-8cd5-4189-b3eb-3a7d91148788" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-61ce844b-8cd5-4189-b3eb-3a7d91148788" class="xr-section-summary">Coordinates: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y_pred_dim_0</span></div><div class="xr-var-dims">(y_pred_dim_0)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 1 2 3 4 5 ... 343 344 345 346 347</div><input id="attrs-1853c9af-4349-4d05-ad28-894d34efda60" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-1853c9af-4349-4d05-ad28-894d34efda60" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-842ee317-123c-4ffe-8205-531810713655" class="xr-var-data-in" type="checkbox"><label for="data-842ee317-123c-4ffe-8205-531810713655" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([  0,   1,   2, ..., 345, 346, 347])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-0b13c23b-02e2-470e-a13b-d9140c200eb2" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-0b13c23b-02e2-470e-a13b-d9140c200eb2" class="xr-section-summary">Data variables: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>y_pred</span></div><div class="xr-var-dims">(y_pred_dim_0)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">16.0 3.0 115.0 ... 13.0 271.0 102.0</div><input id="attrs-1759b3a0-6818-4646-8099-4c390f88e2ff" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-1759b3a0-6818-4646-8099-4c390f88e2ff" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b43c0f89-d687-4d3f-bc89-e7b17b92bb31" class="xr-var-data-in" type="checkbox"><label for="data-b43c0f89-d687-4d3f-bc89-e7b17b92bb31" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 16.,   3., 115.,  73.,  82.,  51.,  15.,  16.,  61., 152.,  30.,
         2.,  16.,  64.,  52.,  78.,  84.,  78.,  16.,   1., 256.,  86.,
       191., 146.,   4.,  11.,  59.,  78.,  68., 164.,  54.,  18.,   1.,
       241.,  88., 173., 226., 135.,  33.,  20.,   8.,  92.,  87., 124.,
       112.,  25., 236., 103., 104.,  33.,  13.,   6.,  11., 353.,  92.,
       223., 238., 271., 520., 219., 116.,  44.,  52.,   6., 101., 517.,
       305., 170., 189., 402., 249., 256., 171.,  29.,   7.,   4.,  14.,
       486., 121., 420., 175., 258., 452., 213., 134.,  68.,  69.,   5.,
       118., 182., 117., 174., 265., 317., 530., 237., 125.,  28.,   7.,
        10., 100., 437., 163., 370., 148., 298., 292., 285., 171., 128.,
         8.,   7., 105., 186.,  93.,  32.,  43.,  72.,  69., 360., 189.,
       277., 482., 180., 148.,  52., 106.,   8., 111.,  67., 101., 214.,
       256., 470., 539., 181., 166.,  31.,   1.,   8., 285., 240., 168.,
       345., 186., 498., 204., 139.,  66.,  54.,   7.,  13., 216., 138.,
        32., 175., 314., 416., 190., 102.,  24.,   6.,   2.,  10., 400.,
       109., 244., 137., 101.,  95.,  19.,  10.,   6.,   5., 354.,  86.,
       376.,  50., 134., 206.,  72.,  17.,  11.,   2.,  89., 530., 191.,
       134., 192., 311., 181., 190.,  84.,  24.,   3.,  20.,  41., 143.,
       190.,  94., 287., 306., 126.,  72.,   4.,   2.,  12., 281., 220.,
       260., 554., 750., 586., 104.,  48.,  33.,  31., 110., 684., 238.,
       457., 224., 656., 459., 271.,  70.,  88.,   1.,  24., 315., 185.,
       229., 265., 541., 769.,  98., 270.,  74.,  21.,  14.,   8., 324.,
       301., 520., 556., 275., 227., 453., 283., 177., 116.,  12.,  40.,
        78., 250., 188., 300., 487., 900., 571., 213., 102.,  30.,  31.,
        28., 497., 414., 451., 221., 292., 241., 582., 397., 189.,  19.,
         7.,  37.,  68., 327., 260., 569., 274., 851., 491., 190., 136.,
        42.,  53.,  42., 532., 237., 459., 234., 331., 671., 596., 317.,
       229.,   5.,   6.,  17., 530., 334., 361., 594., 209., 901., 341.,
       151., 136., 146.,   4.,  41., 154., 269., 253., 313., 711.,  24.,
       357., 217., 216., 182., 605., 551., 267., 162.,  27.,   8.,   4.,
        11., 500., 163., 509., 268., 605., 352.,  96.,  64.,  26.,  38.,
        36., 350.,  90., 135.,  13., 271., 102.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-36549dd6-b371-4fbe-a745-719ab71b5b7b" class="xr-section-summary-in" type="checkbox"><label for="section-36549dd6-b371-4fbe-a745-719ab71b5b7b" class="xr-section-summary">Indexes: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>y_pred_dim_0</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-2d626967-6f2c-453d-883d-8dc9729b887c" class="xr-index-data-in" type="checkbox"><label for="index-2d626967-6f2c-453d-883d-8dc9729b887c" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
       ...
       338, 339, 340, 341, 342, 343, 344, 345, 346, 347],
      dtype='int64', name='y_pred_dim_0', length=348))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-a918746b-b68f-45b3-8ede-61b94f3d4210" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-a918746b-b68f-45b3-8ede-61b94f3d4210" class="xr-section-summary">Attributes: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>created_at :</span></dt><dd>2023-06-14T19:47:12.775956</dd><dt><span>arviz_version :</span></dt><dd>0.15.1</dd><dt><span>inference_library :</span></dt><dd>pymc</dd><dt><span>inference_library_version :</span></dt><dd>5.3.1</dd></dl></div></li></ul></div></div><br></div>
                      </ul>
                  </div>
            </li>
            
              </ul>
            </div>
            <style> /* CSS stylesheet for displaying InferenceData objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-sections.group-sections {
  grid-template-columns: auto;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
.xr-wrap{width:700px!important;} </style>
</div>
</div>
<p>En la siguiente figura la línea azul es la media del número de bicicletas alquiladas, esto es lo mismo que ya vimos en la figura anterior. Los nuevos elementos son la banda turquesa oscuro, que representa el 50% central (cuartiles 0,25 y 0,5) para las bicicletas alquiladas y la banda turquesa claro, que representa el 94% central (cuartiles 0,03 y 0,97).</p>
<p>Podemos notar que nuestro modelo predice un número negativo de bicicletas, lo cual no tiene sentido para nuestro problema, ya que no estemas modelando robo o pérdida de bicicletas. Pero detengamonos un momento a reflexionar sobre nuestro modelo. Tiene sentido, según el modelo, que tengamos valores negativos de bicicletas?</p>
<p>Si, esto debería esperarse ya que usamos una distribución Normal como likelihood en <code>modelo_bl</code>. Una <em>solución</em> muy sucia podría ser recortar las predicciones para valores inferiores a cero, pero eso es feo, feo. En la siguiente sección, veremos que podemos mejorar fácilmente este modelo para evitar predicciones sin sentido.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>linea_media <span class="op">=</span> idata_bl.posterior[<span class="st">'μ'</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb15-2"><a href="#cb15-2"></a>idx <span class="op">=</span> np.argsort(bicis.temperatura.values)</span>
<span id="cb15-3"><a href="#cb15-3"></a>x <span class="op">=</span> np.linspace(bicis.temperatura.<span class="bu">min</span>(), bicis.temperatura.<span class="bu">max</span>(), <span class="dv">15</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a>y_pred_q <span class="op">=</span> idata_bl.posterior_predictive[<span class="st">'y_pred'</span>].quantile([<span class="fl">0.03</span>, <span class="fl">0.97</span>, <span class="fl">0.25</span>, <span class="fl">0.75</span>], dim<span class="op">=</span>[<span class="st">'chain'</span>, <span class="st">'draw'</span>])</span>
<span id="cb15-5"><a href="#cb15-5"></a>y_hat_bounds <span class="op">=</span> <span class="bu">iter</span>([PchipInterpolator(bicis.temperatura.values[idx], y_pred_q[i][idx])(x) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)])</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>_, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb15-8"><a href="#cb15-8"></a>ax.plot(bicis.temperatura, bicis.alquiladas, <span class="st">'.'</span>, color<span class="op">=</span><span class="st">"0.75"</span>,  zorder<span class="op">=-</span><span class="dv">3</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a>ax.plot(bicis.temperatura[idx], linea_media[idx], c<span class="op">=</span><span class="st">'C0'</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="cf">for</span> lb, ub <span class="kw">in</span> <span class="bu">zip</span>(y_hat_bounds, y_hat_bounds): </span>
<span id="cb15-12"><a href="#cb15-12"></a>    ax.fill_between(x,</span>
<span id="cb15-13"><a href="#cb15-13"></a>                    lb, ub,</span>
<span id="cb15-14"><a href="#cb15-14"></a>                    color<span class="op">=</span><span class="st">"C1"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb15-15"><a href="#cb15-15"></a></span>
<span id="cb15-16"><a href="#cb15-16"></a></span>
<span id="cb15-17"><a href="#cb15-17"></a>ax.set_xlabel(<span class="st">'temperatura'</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a>ax.set_ylabel(<span class="st">'bicis alquiladas'</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="generalizando-el-modelo-lineal" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="generalizando-el-modelo-lineal"><span class="header-section-number">6.3</span> Generalizando el modelo lineal</h2>
<p>El modelo lineal que hemos estado usando es un caso especial de un modelo más general, el modelo lineal generalizado (GLM, por su sigla en inglés). El GLM es una generalización del modelo lineal que nos permite utilizar diferentes distribuciones para el likelihood. De forma general (y omitiendo priors), podemos escribir un GLM como:</p>
<p><span class="math display">\[
\begin{aligned}
\mu &amp;= \alpha + \beta X \\
Y &amp;\sim \phi(f(\mu), \theta)
\end{aligned}
\]</span></p>
<p>donde <span class="math inline">\(\phi\)</span> es una distribución arbitraria algunos casos comunes son Normal, Student’s T, Gamma, NegativeBinomial, pero podemos usar otras. <span class="math inline">\(\theta\)</span> representa cualquier parámetro <em>auxiliar</em> o <em>ruido</em> que pueda tener la distribución, por ejemplo <span class="math inline">\(\sigma\)</span> para la distribución Normal. También tenemos <span class="math inline">\(f\)</span>, generalmente llamada función de enlace inverso. Cuando <span class="math inline">\(\phi\)</span> es Normal, entonces <span class="math inline">\(f\)</span> es la función identidad. Para distribuciones como Gamma y NegativeBinomial, <span class="math inline">\(f\)</span> suele ser la función exponencial. ¿Por qué necesitamos <span class="math inline">\(f\)</span>? Porque <span class="math inline">\(\mu\)</span> generalmente tomará valores en los reales, para una distribución como la Normal esto es correcto ya que la media está definida en los reales, pero esto no es necesariamente así para otras distribuciones. Por ejemplo, el parámetro <span class="math inline">\(\mu\)</span> de la Negativa Binomial se define solo para números positivos, por lo que necesitamos una transformación que nos lleve de los reales a los positivos. La función exponencial es un buen candidato para esta transformación. Vamos a explorar varios GLM, un buen ejercicio es crear una tabla y cada vez que veamos una un nuevo GLM, agregar una línea que indique qué es <span class="math inline">\(\phi\)</span>, <span class="math inline">\(\theta\)</span>, <span class="math inline">\(f\)</span> y tal vez algunas notas sobre cuándo se usa este GLM. Bien, comencemos con nuestro primer ejemplo concreto de un GLM.</p>
</section>
<section id="generalizando-el-modelo-lineal-para-datos-de-conteo" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="generalizando-el-modelo-lineal-para-datos-de-conteo"><span class="header-section-number">6.4</span> Generalizando el modelo lineal para datos de conteo</h2>
<p>¿Cómo podemos cambiar <code>modelo_bl</code> para acomodar mejor los datos de las bicicletas? Hay dos cosas a tener en cuenta, el número de bicicletas alquiladas es discreto y está acotado en cero. Esto generalmente se conoce como datos de conteo. Se les llama así porque son el resultado de contar algo. Los datos de conteo a veces se modelan usando una distribución continua como una Normal, especialmente cuando el número de conteos es grande. Pero a menudo es una buena idea usar una distribución discreta. Dos opciones comunes son la distribución de Poisson y el NegativaBinomial. La principal diferencia es que, para la distribución de Poisson, la media y la varianza son iguales y están controladas por un mismo parámetro. Asumir que la media y la varianza son idénticas puede no ser adecuado. En esos casos es común tomar como alternativa la distribución NegativaBinomial, ya que permite que la media y la varianza sean diferentes. Ante la duda es posible generar dos modelos y evaluar si una Poisson o una NegativaBinomial es más adecuada. Más adelante veremos algunos criterios para comparar modelos, por ahora vamos a usar la distribución NegativaBinomial.</p>
<p>El modelo de PyMC es muy similar al anterior, pero con dos diferencias principales. Primero, usamos <code>pm.NegativeBinomial</code> en lugar de <code>pm.Normal</code> para el likelihood. La distribución NegativaBinomial tiene dos parámetros, la media <span class="math inline">\(\mu\)</span> y un parámetro de dispersión <span class="math inline">\(\alpha\)</span>. La varianza de la NegativaBinomial es <span class="math inline">\(\mu + \frac{\mu^2}{\alpha}\)</span>. Entonces, cuanto mayor sea el valor de <span class="math inline">\(\alpha\)</span>, mayor será la varianza. La segunda diferencia es que <span class="math inline">\(\mu\)</span> es <code>pm.math.exp(α + β * bikes.temperatura)</code> en lugar de solo <code>α + β * bikes.temperatura</code>, como ya explicamos, esto es necesario para transformar los realaes a valores positivos.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> modelo_neg:</span>
<span id="cb16-2"><a href="#cb16-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a>    σ <span class="op">=</span> pm.HalfCauchy(<span class="st">'σ'</span>, <span class="dv">10</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">'μ'</span>, pm.math.exp(α <span class="op">+</span> β <span class="op">*</span> bicis.temperatura))</span>
<span id="cb16-6"><a href="#cb16-6"></a>    y_pred <span class="op">=</span> pm.NegativeBinomial(<span class="st">'y_pred'</span>, mu<span class="op">=</span>μ, alpha<span class="op">=</span>σ, observed<span class="op">=</span>bicis.alquiladas)</span>
<span id="cb16-7"><a href="#cb16-7"></a>    idata_neg <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a>    idata_neg.extend(pm.sample_posterior_predictive(idata_neg, random_seed<span class="op">=</span><span class="dv">123</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:04&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 4 seconds.
Sampling: [y_pred]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="4000" class="" max="4000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [4000/4000 00:00&lt;00:00]
    </div>
    
</div>
</div>
<p>La distribución predictiva a posteriori para <code>modelo_neg</code> se muestra en la siguiente figura. Podemos ver que ya no predecimos valores negativos y que la varianza de las predicciones aumenta con la media. Esto es de esperar ya que la varianza de la NegativaBinomial es <span class="math inline">\(\mu + \frac{\mu^2}{\alpha}\)</span>.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>linea_media <span class="op">=</span> idata_neg.posterior[<span class="st">'μ'</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb19-2"><a href="#cb19-2"></a>idx <span class="op">=</span> np.argsort(bicis.temperatura.values)</span>
<span id="cb19-3"><a href="#cb19-3"></a>x <span class="op">=</span> np.linspace(bicis.temperatura.<span class="bu">min</span>(), bicis.temperatura.<span class="bu">max</span>(), <span class="dv">15</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>y_pred_q <span class="op">=</span> idata_neg.posterior_predictive[<span class="st">'y_pred'</span>].quantile([<span class="fl">0.03</span>, <span class="fl">0.97</span>, <span class="fl">0.25</span>, <span class="fl">0.75</span>], dim<span class="op">=</span>[<span class="st">'chain'</span>, <span class="st">'draw'</span>])</span>
<span id="cb19-5"><a href="#cb19-5"></a>y_hat_bounds <span class="op">=</span> <span class="bu">iter</span>([PchipInterpolator(bicis.temperatura.values[idx], y_pred_q[i][idx])(x) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)])</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a>_, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb19-8"><a href="#cb19-8"></a>ax.plot(bicis.temperatura, bicis.alquiladas, <span class="st">'.'</span>, color<span class="op">=</span><span class="st">"0.75"</span>, zorder<span class="op">=-</span><span class="dv">3</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a>ax.plot(bicis.temperatura[idx], linea_media[idx], c<span class="op">=</span><span class="st">'C0'</span>)</span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="cf">for</span> lb, ub <span class="kw">in</span> <span class="bu">zip</span>(y_hat_bounds, y_hat_bounds): </span>
<span id="cb19-12"><a href="#cb19-12"></a>    ax.fill_between(x,</span>
<span id="cb19-13"><a href="#cb19-13"></a>                    lb, ub,</span>
<span id="cb19-14"><a href="#cb19-14"></a>                    color<span class="op">=</span><span class="st">"C1"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-15"><a href="#cb19-15"></a></span>
<span id="cb19-16"><a href="#cb19-16"></a>ax.set_xlabel(<span class="st">'temperatura'</span>)</span>
<span id="cb19-17"><a href="#cb19-17"></a>ax.set_ylabel(<span class="st">'bicis alquiladas'</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>En la siguiente figura tenemos una prueba predictiva a posteriori para <code>modelo_bl</code> a la izquierda y <code>modelo_neg</code> a la derecha. Podemos ver que cuando se usa una Normal, la discrepancia más grande es que el modelo predice valores negativos para las bicicletas alquiladas, pero incluso para los valores positivos vemos que el el ajuste no es tan bueno. Por otro lado, el modelo con la distribución NegativaBinomial ajusta mejor los datos. Aunque el ajuste no es del todo perfecto, vemos que la cola de la distribución es más pesada para las predicciones que para las observaciones, pero también observamos que la probabilidad de esta demanda tan alta es baja. Entonces, en general, reafirmamos que el modelo NegativoBinomial es mejor que el Normal.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb20-2"><a href="#cb20-2"></a>az.plot_ppc(idata_bl,  num_pp_samples<span class="op">=</span><span class="dv">200</span>,  alpha<span class="op">=</span><span class="fl">0.1</span>, colors<span class="op">=</span>[<span class="st">"C1"</span>, <span class="st">"C0"</span>, <span class="st">"C0"</span>], ax<span class="op">=</span>ax[<span class="dv">0</span>], mean<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a>az.plot_ppc(idata_neg, num_pp_samples<span class="op">=</span><span class="dv">200</span>,  alpha<span class="op">=</span><span class="fl">0.1</span>, colors<span class="op">=</span>[<span class="st">"C1"</span>, <span class="st">"C0"</span>, <span class="st">"C0"</span>], ax<span class="op">=</span>ax[<span class="dv">1</span>], mean<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Normal"</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"NegativaBinomial"</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="regresión-robusta" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="regresión-robusta"><span class="header-section-number">6.5</span> Regresión robusta</h2>
<p>Una vez estaba ejecutando una simulación compleja de un sistema molecular. En cada paso de la simulación, necesitabamos calcular una regresión lineal como paso intermedio. Teníamos razones teóricas y empíricas para pensar que nuestra “Y” era condicionalmente normal dada nuestra “X”, por lo que la regresión lineal simple debía funcionar. Pero de vez en cuando la simulación generaba algunos valores de “Y” muy por encima o por debajo de la del grueso de los datos, esto arruinaba completamente nuestra simulación y tenáimos que reiniciarla. Estos valores muy diferentes al grueso de los datos se denominan valores atípicos o aberrantes. El motivo del fracaso de nuestras simulaciones era que los valores atípicos estaban <em>tirando</em> de la línea de regresión hacia valores que daban un muy mal ajuste para el grueso de los datos y cuando pasabamos de esta estimación al siguiente paso de la simulación, todo se detenía. Resolvimos esto con la ayuda de nuestra buena amiga, la distribución T de Student, que como vimos anteriormente, tiene colas más pesadas que la distribución Normal. Esto significa que los valores atípicos tienen menos <em>influencia</em> en el resultado final, que se asemeja más al resultado que hubieramos obtenido en ausencia de los valores <em>atípicos</em>. Esto es un ejemplo de una regresión robusta.</p>
<p>Para ejemplificar la robustez que la distribución T de Student aporta a la regresión lineal, vamos a utilizar un conjunto de datos muy simple. Una versión ligeramente modificada del tercer grupo de datos del <a href="https://en.wikipedia.org/wiki/Anscombe%27s_quartet">cuarteto de Anscombe</a>.</p>
<p>En el siguiente modelo, estamos usando una exponencial desplazada (le sumamos 1) para evitar valores cercanos a cero. La distribución exponencial (no desplazada) pone demasiado peso en los valores cercanos a cero. En mi experiencia, esto está bien para datos con valores atípicos “moderados”, pero en algunos conjuntos de datos pequeños como este, es mejor evitar valores tan bajos. Esta recomendación, como otras, hay que tomarlas con una pizca de sal. Los valores por defecto son buenos puntos de partida, pero no es necesario ceñirse a ellos. Otro priors comunes para Gamma(2, 0.1) o Gamma(mu = 20, sd = 15).</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>ans <span class="op">=</span> pd.read_csv(<span class="st">'datos/anscombe_3.csv'</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a>ans.plot(<span class="st">"x"</span>, <span class="st">"y"</span>, kind<span class="op">=</span><span class="st">"scatter"</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> modelo_t:</span>
<span id="cb22-2"><a href="#cb22-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, mu<span class="op">=</span>ans.y.mean(), sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">'σ'</span>, <span class="dv">5</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a>    ν_ <span class="op">=</span> pm.Exponential(<span class="st">'ν_'</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">29</span>)</span>
<span id="cb22-6"><a href="#cb22-6"></a>    ν <span class="op">=</span> pm.Deterministic(<span class="st">'ν'</span>, ν_ <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb22-7"><a href="#cb22-7"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">'μ'</span>, α <span class="op">+</span> β <span class="op">*</span> ans.x)</span>
<span id="cb22-8"><a href="#cb22-8"></a>    _ <span class="op">=</span> pm.StudentT(<span class="st">'y_pred'</span>, mu<span class="op">=</span>μ, sigma<span class="op">=</span>σ, nu<span class="op">=</span>ν, observed<span class="op">=</span>ans.y)</span>
<span id="cb22-9"><a href="#cb22-9"></a>    idata_t <span class="op">=</span> pm.sample(<span class="dv">2000</span>, random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β, σ, ν_]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="12000" class="" max="12000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [12000/12000 00:04&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 2_000 draw iterations (4_000 + 8_000 draws total) took 4 seconds.</code></pre>
</div>
</div>
<p>En la siguiente figura podemos ver el ajuste robusto, según <code>model_t</code>, y el ajuste no robusto, según <code>linregress</code> de SciPy (esta función está haciendo una regresión por mínimos cuadrados).</p>
<p>Mientras que el ajuste no robusto trata de <em>comprometerse</em> e incluir todos los puntos, el ajuste Bayesiano robusto, <code>model_t</code>, automáticamente <em>descarta</em> (o le reduce <em>peso</em>) a un punto y ajusta una línea que pasa más cerca de todos los puntos restantes</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>beta_c, alpha_c, <span class="op">*</span>_ <span class="op">=</span> linregress(ans.x, ans.y)</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a>_, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb25-4"><a href="#cb25-4"></a>ax.plot(ans.x, (alpha_c <span class="op">+</span> beta_c <span class="op">*</span> ans.x), <span class="st">'C0:'</span>, label<span class="op">=</span><span class="st">'non-robust'</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a>ax.plot(ans.x, ans.y, <span class="st">'C0o'</span>)</span>
<span id="cb25-6"><a href="#cb25-6"></a>alpha_m <span class="op">=</span> idata_t.posterior[<span class="st">'α'</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb25-7"><a href="#cb25-7"></a>beta_m <span class="op">=</span> idata_t.posterior[<span class="st">'β'</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a>x_plot <span class="op">=</span> xr.DataArray(np.linspace(ans.x.<span class="bu">min</span>(), ans.x.<span class="bu">max</span>(), <span class="dv">50</span>), dims<span class="op">=</span><span class="st">"plot_id"</span>)</span>
<span id="cb25-10"><a href="#cb25-10"></a>ax.plot(x_plot, alpha_m <span class="op">+</span> beta_m <span class="op">*</span> x_plot, c<span class="op">=</span><span class="st">'C0'</span>, label<span class="op">=</span><span class="st">"robust"</span>)</span>
<span id="cb25-11"><a href="#cb25-11"></a>az.plot_hdi(ans.x, az.hdi(idata_t.posterior[<span class="st">'μ'</span>])[<span class="st">'μ'</span>].T, ax<span class="op">=</span>ax)</span>
<span id="cb25-12"><a href="#cb25-12"></a>ax.set_xlabel(<span class="st">'x'</span>)</span>
<span id="cb25-13"><a href="#cb25-13"></a>ax.set_ylabel(<span class="st">'y'</span>, rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb25-14"><a href="#cb25-14"></a>ax.legend(loc<span class="op">=</span><span class="dv">2</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>En la siguiente figura podemos ver que obtenemos una muy buena coincidencia. También podemos ver que nuestro modelo predice valores alejados del grueso de los datos hacia ambos lados.</p>
<div class="cell" data-scrolled="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>pm.sample_posterior_predictive(idata_t, model<span class="op">=</span>modelo_t, random_seed<span class="op">=</span><span class="dv">2</span>, extend_inferencedata<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a>ax <span class="op">=</span> az.plot_ppc(idata_t, num_pp_samples<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>),  colors<span class="op">=</span>[<span class="st">"C1"</span>, <span class="st">"C0"</span>, <span class="st">"C1"</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling: [y_pred]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:00&lt;00:00]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-19-output-4.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="regresión-logística" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="regresión-logística"><span class="header-section-number">6.6</span> Regresión logística</h2>
<p>La regresión logistica es la generalización del modelo de regresión simple para cuando la variable dependiente es binaria. Esta generalización se logra en dos pasos. Primero utilizamos la funcion logística como función inversa de enlace:</p>
<p><span class="math display">\[ \text{logística}(z) = \frac{1}{1 + e^{-z}} \]</span></p>
<p>Usamos esta función por que una de sus propiedades es que no importa el valor del argumento <span class="math inline">\(z\)</span>, el resultado siempre será un valor en el intervalo [0, 1]. La función logística es conocida también como función sigmoide, por su aspecto típico de <em>S</em> como se puede ver al ejecutar la siguiente celda:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a>logística <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</span>
<span id="cb28-3"><a href="#cb28-3"></a>plt.plot(z, logística)</span>
<span id="cb28-4"><a href="#cb28-4"></a>plt.xlabel(<span class="st">'z'</span>)</span>
<span id="cb28-5"><a href="#cb28-5"></a>plt.ylabel(<span class="st">'logística(z)'</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>El segundo paso consiste en usar como likelihood una distribución binomial y no una Gaussiana. De esta forma el modelo queda expresado como:</p>
<p><span class="math display">\[
\begin{aligned}
\theta &amp;= \text{logística}(\alpha + \beta X) \\
Y &amp;\sim \text{Bern}(\theta)
\end{aligned}
\]</span></p>
<p>Esto modelo se puede explicar de la siguiente forma. Si nuestros datos son binarios <span class="math inline">\(y \in \{0, 1\}\)</span>, como con el ejemplo de la moneda, vemos que tiene sentido usar una distribución Bernoulli. Esta distribución está parametrizada por un único parámetro en el intervalo [0, 1], el cual puede ser generado desde un modelo lineal siempre y cuando los valores generados por el modelo lineal sean <em>comprimidos</em> al intervalo [0, 1], algo que puede ser obtenido al emplear una función logística.</p>
</section>
<section id="el-modelo-logístico-aplicado-al-conjunto-de-datos-del-iris." class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="el-modelo-logístico-aplicado-al-conjunto-de-datos-del-iris."><span class="header-section-number">6.7</span> El modelo logístico aplicado al conjunto de datos del iris.</h2>
<p>Vamos a aplicar una regresión logística al conjunto de datos Iris. Este es un conjunto de datos clásico que contiene información sobre flores de 3 especies estrechamente relacionadas: setosa, virginica y versicolor. Estas serán nuestras variables dependientes, las clases que queremos predecir. Tenemos 50 individuos de cada especie y para cada individuo el conjunto de datos contiene cuatro variables que vamos a usar como variables independientes. Estas son el largo del pétalo, el ancho del pétalo, el largo del sépalo y el ancho del sépalo. Por si se lo están preguntando, los sépalos son hojas modificadas cuya función está generalmente relacionada con la protección de las flores en la yema.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>iris <span class="op">=</span> pd.read_csv(<span class="st">'datos/iris.csv'</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a>iris.head()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Vamos a comenzar con la regresión logística más simple posible: dos clases, setosa y versicolor, y solo una variable independiente, la longitud del sépalo. Como se hace normalmente, vamos a codificar las variables categóricas setosa y versicolor con los números 0 y 1. Usando Pandas podemos hacer:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>df <span class="op">=</span> iris.query(<span class="st">"species == ('setosa', 'versicolor')"</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a>y_0 <span class="op">=</span> pd.Categorical(df[<span class="st">'species'</span>]).codes</span>
<span id="cb30-3"><a href="#cb30-3"></a>x_n <span class="op">=</span> <span class="st">'sepal_length'</span> </span>
<span id="cb30-4"><a href="#cb30-4"></a>x_0 <span class="op">=</span> df[x_n].values</span>
<span id="cb30-5"><a href="#cb30-5"></a>x_c <span class="op">=</span> x_0 <span class="op">-</span> x_0.mean()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Al igual que con otros modelos lineales, centrar los datos puede ayudar con el muestreo. Ahora que tenemos los datos en el formato adecuado, finalmente podemos construir el modelo con PyMC.</p>
<p>Observe cómo la primera parte del siguiente modelo se asemeja a un modelo de regresión lineal. Este modelo tiene dos variables deterministas: <code>θ</code> y<code>bd</code>. <code>θ</code> es la salida de la función logística aplicada a la variable <code>μ</code> y <code>bd</code> es límite de decisión (el cual explicaremos más adelante). Otro punto que vale la pena mencionar es que en lugar de escribir explícitamente la función logística estamos usando <code>pm.math.sigmoid</code>.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> modelo_rl:</span>
<span id="cb31-2"><a href="#cb31-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a>    </span>
<span id="cb31-5"><a href="#cb31-5"></a>    μ <span class="op">=</span> α <span class="op">+</span> β <span class="op">*</span> x_c   </span>
<span id="cb31-6"><a href="#cb31-6"></a>    θ <span class="op">=</span> pm.Deterministic(<span class="st">'θ'</span>, pm.math.sigmoid(μ))</span>
<span id="cb31-7"><a href="#cb31-7"></a>    bd <span class="op">=</span> pm.Deterministic(<span class="st">'bd'</span>, <span class="op">-</span>α<span class="op">/</span>β)</span>
<span id="cb31-8"><a href="#cb31-8"></a>    </span>
<span id="cb31-9"><a href="#cb31-9"></a>    yl <span class="op">=</span> pm.Bernoulli(<span class="st">'yl'</span>, p<span class="op">=</span>θ, observed<span class="op">=</span>y_0)</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a>    idata_rl <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:01&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 2 seconds.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>az.summary(idata_rl, var_names<span class="op">=</span><span class="st">'~θ'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>α</th>
      <td>0.261</td>
      <td>0.308</td>
      <td>-0.333</td>
      <td>0.821</td>
      <td>0.005</td>
      <td>0.004</td>
      <td>3700.0</td>
      <td>2828.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>β</th>
      <td>5.209</td>
      <td>1.008</td>
      <td>3.489</td>
      <td>7.259</td>
      <td>0.018</td>
      <td>0.013</td>
      <td>3293.0</td>
      <td>2351.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>bd</th>
      <td>-0.049</td>
      <td>0.059</td>
      <td>-0.151</td>
      <td>0.071</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>3755.0</td>
      <td>2745.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Ahora vamos a graficar los datos junto con la curva sigmoide ajustada:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>posterior <span class="op">=</span> idata_rl.posterior</span>
<span id="cb35-2"><a href="#cb35-2"></a>theta <span class="op">=</span> posterior[<span class="st">"θ"</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb35-3"><a href="#cb35-3"></a>idx <span class="op">=</span> np.argsort(x_c)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a>_, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb35-6"><a href="#cb35-6"></a></span>
<span id="cb35-7"><a href="#cb35-7"></a>ax.plot(x_c[idx], theta[idx], color<span class="op">=</span><span class="st">'C0'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-8"><a href="#cb35-8"></a>ax.vlines(posterior[<span class="st">'bd'</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>)), <span class="dv">0</span>, <span class="dv">1</span>, color<span class="op">=</span><span class="st">'C1'</span>, zorder<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-9"><a href="#cb35-9"></a>bd_hdi <span class="op">=</span> az.hdi(posterior[<span class="st">'bd'</span>])</span>
<span id="cb35-10"><a href="#cb35-10"></a>ax.fill_betweenx([<span class="dv">0</span>, <span class="dv">1</span>], bd_hdi[<span class="st">"bd"</span>][<span class="dv">0</span>], bd_hdi[<span class="st">"bd"</span>][<span class="dv">1</span>], color<span class="op">=</span><span class="st">'C1'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, lw<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-11"><a href="#cb35-11"></a>ax.scatter(x_c, np.random.normal(y_0, <span class="fl">0.02</span>), marker<span class="op">=</span><span class="st">'.'</span>, color<span class="op">=</span>[<span class="ss">f'</span><span class="sc">{</span><span class="fl">0.5</span><span class="op">*</span>x<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> x <span class="kw">in</span> y_0])</span>
<span id="cb35-12"><a href="#cb35-12"></a>az.plot_hdi(x_c, posterior[<span class="st">'θ'</span>], color<span class="op">=</span><span class="st">'C0'</span>, ax<span class="op">=</span>ax, fill_kwargs<span class="op">=</span>{<span class="st">"lw"</span>: <span class="dv">0</span>})</span>
<span id="cb35-13"><a href="#cb35-13"></a>ax.set_xlabel(x_n)</span>
<span id="cb35-14"><a href="#cb35-14"></a>ax.set_ylabel(<span class="st">'θ'</span>, rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-15"><a href="#cb35-15"></a><span class="co"># usar escala original para los xticks</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>locs, _ <span class="op">=</span> plt.xticks()</span>
<span id="cb35-17"><a href="#cb35-17"></a>ax.set_xticks(locs, np.<span class="bu">round</span>(locs <span class="op">+</span> x_0.mean(), <span class="dv">1</span>))<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>La figura anterior muestra la longitud del sépalo para las especies (setosa = 0, versicolor = 1). Para mitigar la superposición de los datos, hemos agregado ruido (<em>jitter</em>) a las variable-respuesta que es binaria. Una línea azul en forma de <em>S</em> representa el valor medio de <span class="math inline">\(\theta\)</span>. Esta línea se puede interpretar como la probabilidad que una flor sea versicolor dado el valor de longitud del sépalo. La banda azul semitransparente es el HDI 94%.</p>
</section>
<section id="clasificación-con-regresión-logística" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="clasificación-con-regresión-logística"><span class="header-section-number">6.8</span> Clasificación con regresión logística</h2>
<p>Mi madre prepara un plato delicioso llamado sopa seca, que básicamente es una receta a base de tallarines y que prácticamente no tienen agua. Si bien puede parecer un nombre inapropiado, el nombre del plato cobra total sentido cuando aprendemos cómo se cocina, una parte del agua que se agrega inicialmente se pierde por evaporación y la otra es absorvida por los fideos. Algo similar sucede con la regresión logística. Es usual que este modelo se muestre como un método de clasificación (y no de regresión). Veamos la fuente de esta dualidad.</p>
<p>Los problemas de regresión consisten en predecir un valor continuo para una variable de salida dados los valores de una o más variables de entrada. Y una clasificación es un problema de asignación de valores discretos a una variable de salida dadas unas variables de entrada. Por ejemplo, asignar la clases <code>versicolor</code> dada la longitud de su sépalo.</p>
<p>Entonces, ¿la regresión logística es una regresión o un método de clasificación? La respuesta es que es un método de regresión, solo que la regresión se hace sobre la probabilidad de pertenecer a una de dos clases. Pero también es posible usar una regresión logística como clasificador. Lo único que necesitamos es una regla de decisión. Por ej asignár la clase <code>versicolor</code> si <span class="math inline">\(\theta \ge 0.5\)</span> y <code>setosa</code> en caso contrario.</p>
<p>La línea vertical en la figura anterior es el límite de decisión, y se define como el valor de la variable independiente que hace que la probabilidad de la clase 1 (versicolor en nuestro ejemplo) sea igual a 0,5. Para este modelo podemos calcular este valor analíticamente y es <span class="math inline">\(-\frac{\alpha}{\beta}\)</span>.</p>
<p>A partir de la definición del modelo tenemos la relación:</p>
<p><span class="math display">\[\theta = \text{logística}(\alpha + x \beta)\]</span></p>
<p>Y a partir de la definición de la función logística tenemos que <span class="math inline">\(\theta = 0.5\)</span>, cuando el argumento de la regresión logística es 0, es decir:</p>
<p><span class="math display">\[0.5 = \text{logística}(\alpha + x_i \beta) \Leftrightarrow 0 = \alpha + x_i \beta\]</span></p>
<p>Reordenando encontramos que el valor de <span class="math inline">\(x_i\)</span>, para el cual, <span class="math inline">\(\theta = 0.5\)</span> corresponde a la expresión:</p>
<p><span class="math display">\[x_i = - \frac{\alpha}{\beta}\]</span></p>
<p>Resumiendo los puntos más importantes hasta el momento:</p>
<ul>
<li><p>El valor de <span class="math inline">\(\theta\)</span> es, en términos generales, <span class="math inline">\(p(y= 1 \mid x)\)</span>. En este sentido, la regresión logística es en realidad una regresión, solo que estamos <em>regresionando</em> la probabilidad que una observación pertenezca a la clase 1.</p></li>
<li><p>Estamos modelando la media de una variable dicotómica, es decir, un número en el intervalo [0-1]. Luego, introducimos una regla para convertir esta probabilidad en una asignación de dos clases. En este caso, si <span class="math inline">\(p(y = 1) &gt;= 0.5\)</span> asignamos clase 1, de lo contrario clase 0.</p></li>
<li><p>No hay nada especial en el valor 0.5, aparte de que es el número en el medio entre 0 y 1. Podemos argumentar que este límite solo es razonable si estamos de acuerdo en cometer un error en una u otra dirección. En otras palabras, si es lo mismo para nosotros clasificar erróneamente una setosa como versicolor o una versicolor como setosa. Resulta que este no es siempre el caso, y el costo asociado a la clasificación errónea no tiene por qué ser simétrico.</p></li>
</ul>
</section>
<section id="interpretación-de-los-coeficientes-de-una-regresión-logística" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="interpretación-de-los-coeficientes-de-una-regresión-logística"><span class="header-section-number">6.9</span> Interpretación de los coeficientes de una regresión logística</h2>
<p>Debemos tener cuidado al interpretar los coeficientes <span class="math inline">\(\beta\)</span> de una regresión logística. La interpretación no es tan sencilla como con los modelos lineales en el capítulo anterior. La función logística introduce una no linearidad, que debemos tener en cuenta. Si <span class="math inline">\(\beta\)</span> es positivo, aumentar <span class="math inline">\(x\)</span> aumentará <span class="math inline">\(p(y = 1)\)</span> en cierta cantidad, pero la cantidad no es una función lineal de <span class="math inline">\(x\)</span>, es en cambio una función no-lineal de <span class="math inline">\(x\)</span>. Podemos visualizar este hecho en la figura 4.4, en lugar de una línea con una pendiente constante, tenemos una línea en forma de S con una pendiente que cambia en función de <span class="math inline">\(x\)</span>. Un poco de álgebra nos puede dar una idea de cuánto cambia <span class="math inline">\(p(y=1)\)</span> con <span class="math inline">\(\beta\)</span>:</p>
<p>El modelo logístico básico es:</p>
<p><span class="math display">\[\theta = logistic (\alpha + X \beta) \]</span></p>
<p>El inverso de la logística es la función logit, que es:</p>
<p><span class="math display">\[ logit(z) = log \left (\frac{z}{1-z} \right)\]</span></p>
<p>Por lo tanto, si tomamos la primera ecuación en esta sección y aplicamos la función logit a ambos términos, obtenemos:</p>
<p><span class="math display">\[ logit(\theta) = \alpha + X \beta\]</span></p>
<p>O equivalente:</p>
<p><span class="math display">\[ log \left (\frac{\theta} {1-\theta} \right) = \alpha + X \beta\]</span></p>
<p>Recuerden que <span class="math inline">\(\theta\)</span> en nuestro modelo era la probabilidad de <span class="math inline">\(y = 1\)</span>, por lo tanto:</p>
<p><span class="math display">\[ log \left(\frac {p(y = 1)} {1-p (y = 1)} \right) = \alpha + X \beta \]</span></p>
<p>La cantidad <span class="math display">\[\frac{p (y = 1)} {1-p (y = 1)}\]</span> se conoce como <strong>odds</strong>. Los odds a favor se definen como la relación entre la probabilidad de éxito y la probabilidad de no éxito. Mientras que la probabilidad de obtener 2 tirando un dado es 1/6, los odds para el mismo evento son <span class="math inline">\(\frac{1/6}{5/6} = 0.2\)</span> o dicho de otra forma 1 evento favorable frente a 5 eventos desfavorables. Mientras las probabilidades toman valores en el intervalo [0, 1], los odds lo hacen en <span class="math inline">\([0, \infty)\)</span>. Veamos otro ejemplo, si la probabilidad de lluvia mañana es <span class="math inline">\(\frac{3}{4}\)</span>, entonces la probabilidad de que no llueva es <span class="math inline">\(\frac{1}{4}\)</span> y entonces el odds será de 3. Es decir es tres veces más probable que llueva respecto de que no llueva. Si en cambio la probabilidad fuese <span class="math inline">\(\frac{1}{2}\)</span> entonces el odds sería 1. Es tan probable que llueva como que no lo haga. Los odds suelen ser utilizadas por los apostadores ya que proporcionan una herramienta más intuitiva que las probabilidades <em>en bruto</em> cuando se piensa en la forma correcta de apostar.</p>
<blockquote class="blockquote">
<p>En una regresión logística, el coeficiente <span class="math inline">\(\beta\)</span> codifica el aumento en unidades de log-odds por unidad de aumento de la variable <span class="math inline">\(x\)</span>.</p>
</blockquote>
<p>La transformación de probabilidad a odds es una transformación monotónica, lo que significa que las probabilidades aumentan a medida que aumenta la probabilidad. Mientras que las probabilidades están restringidas al intervalo <span class="math inline">\([0, 1]\)</span>, los odds viven en el intervalo <span class="math inline">\([0, \infty]\)</span>. El logaritmo es otra transformación monótonica y los log-odds están en el intervalo <span class="math inline">\([-\infty, \infty]\)</span>. La siguiente figura muestra cómo la probabilidad está relacionada con los odds y los log-odds.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>probability <span class="op">=</span> np.linspace(<span class="fl">0.01</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb36-2"><a href="#cb36-2"></a>odds <span class="op">=</span> probability <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> probability)</span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a>_, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb36-5"><a href="#cb36-5"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb36-6"><a href="#cb36-6"></a>ax1.plot(probability, odds, <span class="st">'C0'</span>)</span>
<span id="cb36-7"><a href="#cb36-7"></a>ax2.plot(probability, np.log(odds), <span class="st">'C2'</span>)</span>
<span id="cb36-8"><a href="#cb36-8"></a></span>
<span id="cb36-9"><a href="#cb36-9"></a>ax1.set_xlabel(<span class="st">'probabilidad'</span>)</span>
<span id="cb36-10"><a href="#cb36-10"></a>ax1.set_ylabel(<span class="st">'odds'</span>, color<span class="op">=</span><span class="st">'C0'</span>)</span>
<span id="cb36-11"><a href="#cb36-11"></a>ax2.set_ylabel(<span class="st">'log-odds'</span>, color<span class="op">=</span><span class="st">'C2'</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_50519/2677285095.py:2: RuntimeWarning: divide by zero encountered in divide
  odds = probability / (1 - probability)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-26-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Entonces averigüemos cuantas veces más probable es que una flor sea versicolor por unidad del largo del sépalo</p>
</section>
<section id="varianza-variable" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="varianza-variable"><span class="header-section-number">6.10</span> Varianza variable</h2>
<p>Hemos estado usando el modelo lineal para modelar la media de una distribución, dejando la varianza de lado. En caso que consideremos que el supuesto de varianza constante no tiene sentido podemos considerar la varianza como una función (lineal) de la variable dependiente.</p>
<p>La Organización Mundial de la Salud y otras instituciones de salud de todo el mundo recopilan datos para recién nacidos y diseñan estándares de crecimiento. Estas tablas son un componente esencial del conjunto de herramientas pediátricas y también como una medida del bienestar general de las poblaciones con el fin de formular políticas de salud, planificar intervenciones y controlar su eficacia. Un ejemplo de tales datos son la longitud (alturas) de las niñas recién nacidas en función de la edad (en meses):</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'datos/babies.csv'</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a>data.plot.scatter(<span class="st">'Meses'</span>, <span class="st">'Longitud'</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Para modelar estos datos, presentaremos 3 elementos nuevos en comparación con los modelos anteriores:</p>
<ul>
<li><span class="math inline">\(\sigma\)</span> ahora es una función lineal de <span class="math inline">\(x\)</span>, y para hacer esto agregamos dos nuevos parámetros <span class="math inline">\(\gamma\)</span> y <span class="math inline">\(\delta\)</span>, estos son análogos directos de <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span>.</li>
<li>El modelo lineal para la media es una función de <span class="math inline">\(\sqrt{x}\)</span>, esto es solo un truco simple para ajustar un modelo lineal a una curva.</li>
<li>Hemos definido una variable compartida <code>x_shared</code>, esto nos permitirá cambiar los valores de la variable <span class="math inline">\(x\)</span> (<code>Meses</code> en este ejemplo) sin la necesidad de volver a muestrear el modelo. Esto quedará más claro con el ejemplo.</li>
</ul>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model_vv:</span>
<span id="cb39-2"><a href="#cb39-2"></a>    x_shared <span class="op">=</span> pm.MutableData(<span class="st">"x_shared"</span>, data.Meses.values.astype(<span class="bu">float</span>))</span>
<span id="cb39-3"><a href="#cb39-3"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-5"><a href="#cb39-5"></a>    γ <span class="op">=</span> pm.HalfNormal(<span class="st">'γ'</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-6"><a href="#cb39-6"></a>    δ <span class="op">=</span> pm.HalfNormal(<span class="st">'δ'</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-7"><a href="#cb39-7"></a></span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">'μ'</span>, α <span class="op">+</span> β <span class="op">*</span> x_shared<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb39-10"><a href="#cb39-10"></a>    σ <span class="op">=</span> pm.Deterministic(<span class="st">'σ'</span>, γ <span class="op">+</span> δ <span class="op">*</span> x_shared)</span>
<span id="cb39-11"><a href="#cb39-11"></a>    </span>
<span id="cb39-12"><a href="#cb39-12"></a>    y_pred <span class="op">=</span> pm.Normal(<span class="st">'y_pred'</span>, mu<span class="op">=</span>μ, sigma<span class="op">=</span>σ, observed<span class="op">=</span>data.Longitud)</span>
<span id="cb39-13"><a href="#cb39-13"></a>    </span>
<span id="cb39-14"><a href="#cb39-14"></a>    idata_vv <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β, γ, δ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:03&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 4 seconds.</code></pre>
</div>
</div>
<p>La siguiente figura muestra el resultado de nuestro modelo. La media de <span class="math inline">\(\mu\)</span> es representada con una curva negra, y las dos bandas turquesa semitransparentes representan 1 y 2 desviaciones estándar.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>_, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a>axes[<span class="dv">0</span>].plot(data.Meses, data.Longitud, <span class="st">'C0.'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)<span class="op">;</span></span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a>posterior <span class="op">=</span> az.extract(idata_vv)</span>
<span id="cb42-6"><a href="#cb42-6"></a></span>
<span id="cb42-7"><a href="#cb42-7"></a>μ_m <span class="op">=</span> posterior[<span class="st">'μ'</span>].mean(<span class="st">"sample"</span>).values</span>
<span id="cb42-8"><a href="#cb42-8"></a>σ_m <span class="op">=</span> posterior[<span class="st">'σ'</span>].mean(<span class="st">"sample"</span>).values</span>
<span id="cb42-9"><a href="#cb42-9"></a></span>
<span id="cb42-10"><a href="#cb42-10"></a>axes[<span class="dv">0</span>].plot(data.Meses, μ_m, c<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb42-11"><a href="#cb42-11"></a>axes[<span class="dv">0</span>].fill_between(data.Meses, μ_m <span class="op">+</span> <span class="dv">1</span> <span class="op">*</span> σ_m, μ_m <span class="op">-</span> <span class="dv">1</span> <span class="op">*</span> σ_m, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'C1'</span>)</span>
<span id="cb42-12"><a href="#cb42-12"></a>axes[<span class="dv">0</span>].fill_between(data.Meses, μ_m <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> σ_m, μ_m <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> σ_m, alpha<span class="op">=</span><span class="fl">0.4</span>, color<span class="op">=</span><span class="st">'C1'</span>)</span>
<span id="cb42-13"><a href="#cb42-13"></a></span>
<span id="cb42-14"><a href="#cb42-14"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Meses'</span>)</span>
<span id="cb42-15"><a href="#cb42-15"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Longitud'</span>)<span class="op">;</span></span>
<span id="cb42-16"><a href="#cb42-16"></a></span>
<span id="cb42-17"><a href="#cb42-17"></a></span>
<span id="cb42-18"><a href="#cb42-18"></a>axes[<span class="dv">1</span>].plot(data.Meses, σ_m)</span>
<span id="cb42-19"><a href="#cb42-19"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Meses'</span>)<span class="op">;</span></span>
<span id="cb42-20"><a href="#cb42-20"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="vs">r'$\bar ϵ$'</span>, rotation<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ahora que tenemos ajustado el modelo podríamos querer usar el modelo para averiguar cómo se compara la longitud de una niña en particular respecto de la distribución. Una forma de responder a esta pregunta es preguntarle al modelo por la distribución de la variable <em>longitud</em> para bebas de digamos de 0.5 meses. Usando PyMC podemos hacer estas preguntas con la función <code>pm.sample_posterior_predictive</code>, ya que esto arrojará muestras de <span class="math inline">\(\tilde y\)</span> es decir los valores predichos considerando la incertidumbre de los parámetros. El único problema es que, por defecto, esta función devolverá valores de <span class="math inline">\(\tilde y\)</span> para los valores observados de <span class="math inline">\(x\)</span>, es decir los valores usando para ajustar el modelo. Pero que pasa si queremos obtener predicciones para que el modelo no vio? Como 0,5 meses que no es parte de los datos originales. La manera más fácil de obtener predicciones para valores no observados es definir una variable compartida (<code>x_shared</code> en el ejemplo) y luego actualizar el valor de la variable compartida justo antes del muestreo de la distribución predictiva <em>a posteriori</em>.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="cf">with</span> model_vv:</span>
<span id="cb43-2"><a href="#cb43-2"></a>    pm.set_data({<span class="st">"x_shared"</span>: [<span class="fl">0.5</span>]})</span>
<span id="cb43-3"><a href="#cb43-3"></a>    ppc <span class="op">=</span> pm.sample_posterior_predictive(idata_vv, random_seed<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb43-4"><a href="#cb43-4"></a>    y_ppc <span class="op">=</span> ppc.posterior_predictive[<span class="st">'y_pred'</span>].stack(sample<span class="op">=</span>(<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling: [y_pred]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="5" class="" max="4000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      0.12% [5/4000 00:00&lt;00:03]
    </div>
    
</div>
</div>
<p>Ahora podemos graficar la distribución esperada de las longitudes para las bebas con 2 semanas de vida y calcular cantidades adicionales, por ejemplo, el percentil de una niña de esa longitud:</p>
<div class="cell" data-scrolled="true" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a>ref <span class="op">=</span> <span class="fl">52.5</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>grid, pdf <span class="op">=</span> az.stats.density_utils._kde_linear(y_ppc.values)</span>
<span id="cb45-3"><a href="#cb45-3"></a>plt.plot(grid, pdf)</span>
<span id="cb45-4"><a href="#cb45-4"></a>percentile <span class="op">=</span> <span class="bu">int</span>((y_ppc <span class="op">&lt;=</span> ref).mean() <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb45-5"><a href="#cb45-5"></a>plt.fill_between(grid[grid <span class="op">&lt;</span> ref], pdf[grid <span class="op">&lt;</span> ref], label<span class="op">=</span><span class="st">'percentil = </span><span class="sc">{:2d}</span><span class="st">'</span>.<span class="bu">format</span>(percentile))</span>
<span id="cb45-6"><a href="#cb45-6"></a>plt.xlabel(<span class="st">'longitud'</span>)</span>
<span id="cb45-7"><a href="#cb45-7"></a>plt.yticks([])</span>
<span id="cb45-8"><a href="#cb45-8"></a>plt.legend()<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="regresión-por-cuantiles" class="level2" data-number="6.11">
<h2 data-number="6.11" class="anchored" data-anchor-id="regresión-por-cuantiles"><span class="header-section-number">6.11</span> Regresión por cuantiles</h2>
<p>En los ejemplos anteriores nos focalizamos en usar un modelo lineal para estimar la media de la variable respuesta, también vimos que es posible usar la misma idea para estimar la varianza. Además, aprendimos que usar un likelihood Normal es solo una de muchas opciones, como Binomial, Negativa Binomial, t de Student, etc.</p>
<p>En esta sección vamos a discutir un modelo lineal, cuyo objetivo no es la estimación de media o varianza, en cambio la estimación de <a href="https://es.wikipedia.org/wiki/Cuantil">cuantiles</a>. Cuando el cuantil a estimar es la mediana, la motivación suele ser la necesidad de una regresión robusta. Así como la mediana es un estimador de la media, robusto a valores extremos, una <em>regresión mediana</em> será también robusta. En ese caso la regresión por cuantiles cumpliría una función similar al modelo robusto que vimos anteriormente usando una distribución t de Student. Otras veces, la motivación está en modelar cuantiles específicos por que estos son “intrínsecamente” de interés. Esto sucede por ejemplo cuando nos interesa modelador valores en los extremos de una distribución. Por ejemplo podríamos estar interesados en modelar temperaturas altas, o eventos de lluvia intensos. A veces también se usa para explorar relaciones entre variables cuando no hay relación entre las medias de dichas variables, o cuando esta es muy débil. Una disciplina donde las regresiones por cuantiles son frecuentes es la ecología. Esto se debe posiblemente, a que la existencia de complejas interacciones entre variables, donde el efecto de una variable sobre otra es distinto para distintos rangos de la variable.</p>
<p>Para hacer regresiones por cuantiles utilizamos la distribución asimétrica de Laplace como likelihood. Esta distribución la podemos pensar como dos distribuciones exponenciales espalda-con-espalda. La distribución tiene 3 parámetros <span class="math inline">\(\mu\)</span> controla la localización, <span class="math inline">\(\sigma\)</span> la escala y <span class="math inline">\(q\)</span> la asimetría. <span class="math inline">\(q\)</span> varía entre [0, 1], cuando <span class="math inline">\(q=0.5\)</span> la distribución asimétrica de Laplace es en realidad simétrica. Este caso especial es conocido también como distribución de Laplace. Cuando hacemos regresión por cuantiles, podemos pensar a <span class="math inline">\(q\)</span> como los cuantiles que nos interesa asociar con la variable respuesta. Por ejemplo, si <span class="math inline">\(q=0.5\)</span> estamos modelando la mediana, si <span class="math inline">\(q=0.25\)</span> estamos modelando el primer cuartil, etc.</p>
<p>La siguiente figuras muestras tres distribuciones de esta familia.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a>q <span class="op">=</span> np.array([<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>])</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="cf">for</span> q_i, mu <span class="kw">in</span> <span class="bu">zip</span>(q, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb46-3"><a href="#cb46-3"></a>    pz.AsymmetricLaplace(mu<span class="op">=</span>mu, b<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span>q_i).plot_pdf(support<span class="op">=</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Quiere decir esto que al hacer una regresión por cuantiles estamos asumiendo que la variable respuesta se distribuye (condicionalmente) como una Asimétrica de Laplace? No necesariamente.</p>
<p>Una forma alternativa de pensar el likelihood, es como una función de error (o de diferencia) entre el ajuste lineal y los datos. Al elegir una distribución determinada estamos, indirectamente, eligiendo como penalizaremos esa diferencia y al hacer inferencia estámos encontrando la distribución de parámetros que reducen esa diferencia. Usando esta lógica podemos pensar que una gaussiana le asigna un determinado peso a valores alejados de la media y una t de Student le asigna un menor peso, y por ende terminamos teniendo un ajuste más robusto. De la misma forma una asimétrica de Laplace le asigna una determinado peso a estas diferencias de forma tal que el resultado final es ajustar cuantiles en vez de medias. Si esto les suena extraño es por que están prestando atención.</p>
<hr>
<p>Para ejemplificar la regresión por cuantiles vamos a usar el dataset de las longitudes de bebés que usamos anteriormente. Vamos a ajustar 3 cuantiles al mismo tiempo, 0.05, 0.5, 0.95. Esto nos va a permitir ver como cambia la relación entre las variables a medida que nos movemos de los cuantiles bajos a los altos. Para esto vamos a “apilar” el dataset 3 veces, una para cada cuantil.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>y_con <span class="op">=</span> np.stack([data.Longitud.values]<span class="op">*</span> <span class="dv">3</span>).T</span>
<span id="cb47-2"><a href="#cb47-2"></a>x_con <span class="op">=</span> np.stack([data.Meses.values]<span class="op">*</span> <span class="dv">3</span>).T</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model_q:</span>
<span id="cb48-2"><a href="#cb48-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, <span class="dv">50</span>, <span class="dv">3</span>, shape<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, <span class="dv">0</span>, <span class="dv">5</span>, shape<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb48-4"><a href="#cb48-4"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">'σ'</span>, <span class="dv">5</span>)</span>
<span id="cb48-5"><a href="#cb48-5"></a></span>
<span id="cb48-6"><a href="#cb48-6"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">'μ'</span>, α <span class="op">+</span> β <span class="op">*</span> x_con<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb48-7"><a href="#cb48-7"></a>    </span>
<span id="cb48-8"><a href="#cb48-8"></a>    y_pred <span class="op">=</span> pm.AsymmetricLaplace(<span class="st">'y_pred'</span>,  mu<span class="op">=</span>μ, b<span class="op">=</span>σ, q<span class="op">=</span>q, observed<span class="op">=</span>y_con)</span>
<span id="cb48-9"><a href="#cb48-9"></a>    </span>
<span id="cb48-10"><a href="#cb48-10"></a>    idata_q <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:07&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 8 seconds.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>plt.plot(data.Meses, data.Longitud, <span class="st">"."</span>, color<span class="op">=</span><span class="st">"0.5"</span>)</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="cf">for</span> idx, label <span class="kw">in</span> <span class="bu">enumerate</span>((<span class="st">"q=0.1"</span>, <span class="st">"q=0.5"</span>, <span class="st">"q=0.9"</span>)):</span>
<span id="cb51-3"><a href="#cb51-3"></a>    plt.plot(data.Meses.values, idata_q.posterior[<span class="st">"μ"</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))[:,idx],</span>
<span id="cb51-4"><a href="#cb51-4"></a>            label<span class="op">=</span>label, lw<span class="op">=</span><span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>    </span>
<span id="cb51-6"><a href="#cb51-6"></a>plt.legend()<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Para que sea más claro que estámos haciendo al hacer una regresión por cuantiles, comparemos el resultado con una regresión “normal”.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model_n:</span>
<span id="cb52-2"><a href="#cb52-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">'α'</span>, <span class="dv">50</span>, <span class="dv">3</span>)</span>
<span id="cb52-3"><a href="#cb52-3"></a>    β <span class="op">=</span> pm.Normal(<span class="st">'β'</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb52-4"><a href="#cb52-4"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">'σ'</span>, <span class="dv">5</span>)</span>
<span id="cb52-5"><a href="#cb52-5"></a></span>
<span id="cb52-6"><a href="#cb52-6"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">'μ'</span>, α <span class="op">+</span> β <span class="op">*</span> data.Meses.values<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb52-7"><a href="#cb52-7"></a>    </span>
<span id="cb52-8"><a href="#cb52-8"></a>    y_pred <span class="op">=</span> pm.Normal(<span class="st">'y_pred'</span>,  μ, σ, observed<span class="op">=</span>data.Longitud.values)</span>
<span id="cb52-9"><a href="#cb52-9"></a>    </span>
<span id="cb52-10"><a href="#cb52-10"></a>    idata_n <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:02&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 3 seconds.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a>ax.plot(data.Meses, data.Longitud, <span class="st">"."</span>, color<span class="op">=</span><span class="st">"0.8"</span>)</span>
<span id="cb55-4"><a href="#cb55-4"></a>lines <span class="op">=</span> []</span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="cf">for</span> idx, label <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="ss">f"</span><span class="sc">{</span>q_i<span class="op">=</span><span class="sc">:}</span><span class="ss">"</span> <span class="cf">for</span> q_i <span class="kw">in</span> q]):</span>
<span id="cb55-6"><a href="#cb55-6"></a>    line, <span class="op">=</span> ax.plot(data.Meses,</span>
<span id="cb55-7"><a href="#cb55-7"></a>                   idata_q.posterior[<span class="st">"μ"</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))[:,idx],</span>
<span id="cb55-8"><a href="#cb55-8"></a>                   label<span class="op">=</span>label)</span>
<span id="cb55-9"><a href="#cb55-9"></a>    lines.append(line)</span>
<span id="cb55-10"><a href="#cb55-10"></a>    </span>
<span id="cb55-11"><a href="#cb55-11"></a>q_legend <span class="op">=</span> ax.legend(handles<span class="op">=</span>lines, loc<span class="op">=</span><span class="st">'upper left'</span>, title<span class="op">=</span><span class="st">"Regresión por cuantiles"</span>)</span>
<span id="cb55-12"><a href="#cb55-12"></a></span>
<span id="cb55-13"><a href="#cb55-13"></a><span class="co"># aproximamos los cuantiles de la distribución posterior</span></span>
<span id="cb55-14"><a href="#cb55-14"></a>q_95 <span class="op">=</span> (idata_n.posterior[<span class="st">"μ"</span>] <span class="op">+</span> idata_n.posterior[<span class="st">"σ"</span>]<span class="op">*</span><span class="fl">1.65</span>).mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb55-15"><a href="#cb55-15"></a>q_05 <span class="op">=</span> (idata_n.posterior[<span class="st">"μ"</span>] <span class="op">-</span> idata_n.posterior[<span class="st">"σ"</span>]<span class="op">*</span><span class="fl">1.65</span>).mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb55-16"><a href="#cb55-16"></a></span>
<span id="cb55-17"><a href="#cb55-17"></a>line0, <span class="op">=</span> ax.plot(data.Meses, q_05, <span class="st">"C0"</span>, label<span class="op">=</span><span class="st">"μ - 1.65σ"</span>, ls<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb55-18"><a href="#cb55-18"></a>line1, <span class="op">=</span> ax.plot(data.Meses, idata_n.posterior[<span class="st">"μ"</span>].mean((<span class="st">"chain"</span>, <span class="st">"draw"</span>)), <span class="st">"C1"</span>, label<span class="op">=</span><span class="st">"μ"</span>, ls<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb55-19"><a href="#cb55-19"></a>line2, <span class="op">=</span> ax.plot(data.Meses, q_95, <span class="st">"C2"</span>, label<span class="op">=</span><span class="st">"μ + 1.65σ"</span>, ls<span class="op">=</span><span class="st">"--"</span>)<span class="op">;</span></span>
<span id="cb55-20"><a href="#cb55-20"></a></span>
<span id="cb55-21"><a href="#cb55-21"></a>ax.add_artist(q_legend)</span>
<span id="cb55-22"><a href="#cb55-22"></a></span>
<span id="cb55-23"><a href="#cb55-23"></a>ax.legend(handles<span class="op">=</span>[line0, line1, line2], loc<span class="op">=</span><span class="st">'lower right'</span>, title<span class="op">=</span><span class="st">"Regresión normal"</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Podemos ver que al usar una distribución Normal y a partir de ella computar los cuantiles, q=0.1 (<span class="math inline">\(\mu - 1.65\sigma\)</span>) y q=0.9 (<span class="math inline">\(\mu + 1.65\sigma\)</span>) estos son simétricos respecto de la media <span class="math inline">\(\mu\)</span>. Además podemos ver que la forma de la curva es esencialmente la misma para los 3 casos, solo que desplazada hacia arriba o abajo. Además las curvas generadas al usar la distribución asimétrica de Laplace permite acomodarse a la varianza no constante, vean como las curvas empiezan muy cerca en el mes cero y se van separando a medida que pasan los meses.</p>
</section>
<section id="regresión-lineal-jerárquica" class="level2" data-number="6.12">
<h2 data-number="6.12" class="anchored" data-anchor-id="regresión-lineal-jerárquica"><span class="header-section-number">6.12</span> Regresión lineal jerárquica</h2>
<p>Hace dos capítulos, aprendimos los rudimentos de los modelos jerárquicos. Este mismo concepto se puede aplicar a las regresiones lineales. Esto permite que los modelos realicen inferencias a nivel de subgrupo y a nivel global. Como ya vimos, esto se hace incluyendo hiperpriors.</p>
<p>Vamos a crear ocho grupos de datos relacionados, incluido un grupo con un solo dato</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>N <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>grupos <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>]</span>
<span id="cb56-3"><a href="#cb56-3"></a>M <span class="op">=</span> <span class="bu">len</span>(grupos)</span>
<span id="cb56-4"><a href="#cb56-4"></a>idx <span class="op">=</span> np.repeat(<span class="bu">range</span>(M <span class="op">-</span> <span class="dv">1</span>), N)</span>
<span id="cb56-5"><a href="#cb56-5"></a>idx <span class="op">=</span> np.append(idx, <span class="dv">7</span>)</span>
<span id="cb56-6"><a href="#cb56-6"></a>np.random.seed(<span class="dv">314</span>)</span>
<span id="cb56-7"><a href="#cb56-7"></a>alpha_real <span class="op">=</span> np.random.normal(<span class="fl">2.5</span>, <span class="fl">0.5</span>, size<span class="op">=</span>M)</span>
<span id="cb56-8"><a href="#cb56-8"></a>beta_real <span class="op">=</span> np.random.beta(<span class="dv">6</span>, <span class="dv">1</span>, size<span class="op">=</span>M)</span>
<span id="cb56-9"><a href="#cb56-9"></a>eps_real <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.5</span>, size<span class="op">=</span><span class="bu">len</span>(idx))</span>
<span id="cb56-10"><a href="#cb56-10"></a>y_m <span class="op">=</span> np.zeros(<span class="bu">len</span>(idx))</span>
<span id="cb56-11"><a href="#cb56-11"></a>x_m <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">len</span>(idx))</span>
<span id="cb56-12"><a href="#cb56-12"></a>y_m <span class="op">=</span> alpha_real[idx] <span class="op">+</span> beta_real[idx] <span class="op">*</span> x_m <span class="op">+</span> eps_real</span>
<span id="cb56-13"><a href="#cb56-13"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-14"><a href="#cb56-14"></a>ax <span class="op">=</span> np.ravel(ax)</span>
<span id="cb56-15"><a href="#cb56-15"></a>j, k <span class="op">=</span> <span class="dv">0</span>, N</span>
<span id="cb56-16"><a href="#cb56-16"></a><span class="cf">for</span> i, g <span class="kw">in</span> <span class="bu">enumerate</span>(grupos):</span>
<span id="cb56-17"><a href="#cb56-17"></a>    ax[i].scatter(x_m[j:k], y_m[j:k], marker<span class="op">=</span><span class="st">"."</span>)</span>
<span id="cb56-18"><a href="#cb56-18"></a>    ax[i].set_title(<span class="ss">f"grupo </span><span class="sc">{</span>g<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-19"><a href="#cb56-19"></a>    j <span class="op">+=</span> N</span>
<span id="cb56-20"><a href="#cb56-20"></a>    k <span class="op">+=</span> N</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Veamos un posible modelo para estos datos:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>coords <span class="op">=</span> {<span class="st">"grupo"</span>: grupos}</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> modelo_jerárquico:</span>
<span id="cb57-4"><a href="#cb57-4"></a>    <span class="co"># hyper-priors</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>    α_μ <span class="op">=</span> pm.Normal(<span class="st">"α_μ"</span>, mu<span class="op">=</span>y_m.mean(), sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-6"><a href="#cb57-6"></a>    α_σ <span class="op">=</span> pm.HalfNormal(<span class="st">"α_σ"</span>, <span class="dv">5</span>)</span>
<span id="cb57-7"><a href="#cb57-7"></a>    β_μ <span class="op">=</span> pm.Normal(<span class="st">"β_μ"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-8"><a href="#cb57-8"></a>    β_σ <span class="op">=</span> pm.HalfNormal(<span class="st">"β_σ"</span>, sigma<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb57-9"><a href="#cb57-9"></a></span>
<span id="cb57-10"><a href="#cb57-10"></a>    <span class="co"># priors</span></span>
<span id="cb57-11"><a href="#cb57-11"></a>    α <span class="op">=</span> pm.Normal(<span class="st">"α"</span>, mu<span class="op">=</span>α_μ, sigma<span class="op">=</span>α_σ, dims<span class="op">=</span><span class="st">"grupo"</span>)</span>
<span id="cb57-12"><a href="#cb57-12"></a>    β <span class="op">=</span> pm.Normal(<span class="st">"β"</span>, mu<span class="op">=</span>β_μ, sigma<span class="op">=</span>β_σ, dims<span class="op">=</span><span class="st">"grupo"</span>)</span>
<span id="cb57-13"><a href="#cb57-13"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">"σ"</span>, <span class="dv">5</span>)</span>
<span id="cb57-14"><a href="#cb57-14"></a>    _ <span class="op">=</span> pm.Normal(<span class="st">"y_pred"</span>, mu<span class="op">=</span>α[idx] <span class="op">+</span> β[idx] <span class="op">*</span> x_m, sigma<span class="op">=</span>σ, observed<span class="op">=</span>y_m)</span>
<span id="cb57-15"><a href="#cb57-15"></a></span>
<span id="cb57-16"><a href="#cb57-16"></a>    idata_mj <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α_μ, α_σ, β_μ, β_σ, α, β, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:05&lt;00:00 Sampling 4 chains, 149 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 5 seconds.
The rhat statistic is larger than 1.01 for some parameters. This indicates problems during sampling. See https://arxiv.org/abs/1903.08008 for details
The effective sample size per chain is smaller than 100 for some parameters.  A higher number is needed for reliable rhat and ess computation. See https://arxiv.org/abs/1903.08008 for details
There were 149 divergences after tuning. Increase `target_accept` or reparameterize.</code></pre>
</div>
</div>
<p>Vemos que obtenemos un mesaje de advertencia indicando divergencias y dos sugerencias para solucionar el problema. La primera es incrementar <code>target_accept</code> la segunda reparametrizar. Este mensaje indica que las muestras generadas por PyMC pueden no ser confiables, esto se vincula a los diagnósticos que vimos en el capítulo anterior.</p>
<p>La primer sugerencias es aumentar <code>target_accept</code>, que es un argumento de <code>pm.sample()</code> que por defecto toma el valor 0.8 y puede tomar valores en el intervalo (0, 1). Si ves divergencias, como en este caso, cambiar el valor por defecto a valores tales como 0.85, 0.9 o incluso más puede ayudar. En algunos casos incluso valores altos como 0.99 no serán de ayuda. Un efecto adverso de aumentar <code>target_accept</code> es que el sampler suele demorar más en generar una misma cantidad de muestras.</p>
<p>Si las divergencias no desaparecen al cambiar <code>target_accept</code>, en general la única solución es reparametrizar. ¿Qué es esto? Reparametrizar es escribir un modelo de una manera diferente, pero matemáticamente equivalente a su versión original. Muchos modelos (por no decir todos) se pueden escribir de formas alternativas. A veces, la reparametrización puede tener un efecto positivo en la eficiencia del método de muestreo o en la interpretabilidad del modelo. Por ejemplo, al reparametrizar podemos eliminar las divergencias.</p>
<p>Si prueban volver a correr <code>modelo_jerárquico</code> pero con valores más altos de <code>target_accept</code> verán que las divergecias disminuyen pero no desaparecen. Lamentablemente esto es algo común con modelos lineales jerárquicos, lo bueno es que existe una reparametrización que suele solucionar el problema. La reparametrización consiste en reescribir el modelo de la siguiente forma:</p>
<p>En vez definir <span class="math inline">\(\beta \mathcal{N}(\beta_\mu, \beta_\sigma)\)</span> como en <code>modelo_jerárquico</code> vamos a escribir <span class="math inline">\(\beta = \beta_\mu + \beta_\text{offset} * \beta_\sigma\)</span>. Donde <span class="math inline">\(\beta_\text{offset}\)</span> es una distribución normal con media 0 y desviación estándar 1. Conceptualmente la diferencia es que en el primer caso estamos modelando la pendiente de cada grupo de forma explícita, mientras que en el segundo caso lo estamos haciendo como una desviación respecto de un valor común (<span class="math inline">\(\beta_\mu\)</span>). A la primer versión se la suele llamar centrada y a la segunda no-centrada. Veamos como queda el modelo no-centrado en PyMC:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> jerárquico_no_centrado:</span>
<span id="cb60-2"><a href="#cb60-2"></a>    <span class="co"># hyper-priors</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>    α_μ <span class="op">=</span> pm.Normal(<span class="st">"α_μ"</span>, mu<span class="op">=</span>y_m.mean(), sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb60-4"><a href="#cb60-4"></a>    α_σ <span class="op">=</span> pm.HalfNormal(<span class="st">"α_σ"</span>, <span class="dv">5</span>)</span>
<span id="cb60-5"><a href="#cb60-5"></a>    β_μ <span class="op">=</span> pm.Normal(<span class="st">"β_μ"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb60-6"><a href="#cb60-6"></a>    β_σ <span class="op">=</span> pm.HalfNormal(<span class="st">"β_σ"</span>, sigma<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb60-7"><a href="#cb60-7"></a></span>
<span id="cb60-8"><a href="#cb60-8"></a>    <span class="co"># priors</span></span>
<span id="cb60-9"><a href="#cb60-9"></a>    α <span class="op">=</span> pm.Normal(<span class="st">"α"</span>, mu<span class="op">=</span>α_μ, sigma<span class="op">=</span>α_σ, dims<span class="op">=</span><span class="st">"grupo"</span>)</span>
<span id="cb60-10"><a href="#cb60-10"></a></span>
<span id="cb60-11"><a href="#cb60-11"></a>    β_offset <span class="op">=</span> pm.Normal(<span class="st">"β_offset"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>, dims<span class="op">=</span><span class="st">"grupo"</span>)</span>
<span id="cb60-12"><a href="#cb60-12"></a>    β <span class="op">=</span> pm.Deterministic(<span class="st">"β"</span>, β_μ <span class="op">+</span> β_offset <span class="op">*</span> β_σ, dims<span class="op">=</span><span class="st">"grupo"</span>)</span>
<span id="cb60-13"><a href="#cb60-13"></a></span>
<span id="cb60-14"><a href="#cb60-14"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">"σ"</span>, <span class="dv">5</span>)</span>
<span id="cb60-15"><a href="#cb60-15"></a>    _ <span class="op">=</span> pm.Normal(<span class="st">"y_pred"</span>, mu<span class="op">=</span>α[idx] <span class="op">+</span> β[idx] <span class="op">*</span> x_m, sigma<span class="op">=</span>σ, observed<span class="op">=</span>y_m)</span>
<span id="cb60-16"><a href="#cb60-16"></a></span>
<span id="cb60-17"><a href="#cb60-17"></a>    idata_ncen <span class="op">=</span> pm.sample(target_accept<span class="op">=</span><span class="fl">0.85</span>, random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α_μ, α_σ, β_μ, β_σ, α, β_offset, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:08&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 9 seconds.</code></pre>
</div>
</div>
<p>Al correr <code>jerárquico_no_centrado</code> sin modificar <code>target_accept</code> verán todavía quedan unas pocas divergencias. 2 en mi caso, un número tan bajo no suele ser problemático. Pero para estar seguros podemos aumentar <code>target_accept</code> a 0.85, como en el bloque de código anterior. Al hacer eso veremos que no hay divergencias y podremos seguir con nuestro análisis. Pero antes de hacer eso veamos que es lo que estamos haciendo al reparametrizar.</p>
<p>La siguiente figura muestra muestra dos paneles, a la izquierda tenemos un gráfico de dispersión entre los valores de <span class="math inline">\(\log \beta_\sigma\)</span> (el logaritmo de la desviación estándar global) y <span class="math inline">\(\beta_B\)</span>. A la derecha entre <span class="math inline">\(\log \beta_\sigma\)</span> y la pendiente del grupo H. Los puntos negros representan divergencias. En ambos casos se observa una forma de “embudo” más ancha arriba y más angosta abajo (esto es más acentuado en el panel de la derecha). En ambos casos a medida que <span class="math inline">\(\beta_\sigma\)</span> aumenta el embudo se ensancha, ya que la dispersión de <span class="math inline">\(\beta\)</span> aumenta. Esto es razonable ya que precisamente <span class="math inline">\(\beta_\sigma\)</span> controla cuan variable puede ser <span class="math inline">\(\beta\)</span> respecto de su media. En si mismo esto no es un problema, es simplemente una consecuencia directa del modelo. Pero si es un problema para el método de muestreo, como vimos en el capítulo anterior, para obtener un método eficiente el método de muestreo debe “aprender” ciertos hiper-parámetros. El problema que en una geometría como el embudo, no hay un solo conjunto de hiper-parámetros que sean lo suficientemente buenos para muestrear tanto la boca del embudo como su pico. En general el método “aprende” a muestrear la parate ancha y cuando se aproxima a la parte angosta la trayectoria “diverge” de la correcta. Es como si usáramos los cálculos para poner un satélite en orbita de la tierra, para ponerlo en órbita de la luna, perderíamos el satélite en el espacio.</p>
<p>Nota: Para la figura usamos <span class="math inline">\(\log \beta_\sigma\)</span> en vez de <span class="math inline">\(\beta_\sigma\)</span>, por que esto es lo que “ve” el sampler. Por qué? Por que internamente PyMC muestrea los parámetros en un espacio sin “bordes” para eso convierte distribuciones como la Beta que tienen soporte en el intervalo (0, 1) a una distribución que tiene soporte en todo el espacio real. Lo mismo hace con distribuciones como la media-normal. En el caso de esta última la transformación es logarítmica. Una vez terminado el muestreo PyMC invierte la trasformación quedando los parámetros en la escala original y por eso nosotros vemos los valores de <span class="math inline">\(\beta_\sigma\)</span> y no <span class="math inline">\(\log \beta_\sigma\)</span>. Pero el sampler ve <span class="math inline">\(\log \beta_\sigma\)</span> por eso es conveniente graficar en esa escala.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>idata_mj.posterior[<span class="st">"log(β_σ)"</span>] <span class="op">=</span> np.log(idata_mj.posterior[<span class="st">"β_σ"</span>])</span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a>_, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, sharey<span class="op">=</span><span class="st">"row"</span>, sharex<span class="op">=</span><span class="st">"col"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="bu">vars</span> <span class="op">=</span> [<span class="st">"log(β_σ)"</span>, <span class="st">"log(β_σ)"</span>]</span>
<span id="cb63-6"><a href="#cb63-6"></a>glabel <span class="op">=</span> [<span class="st">"B"</span>, <span class="st">"H"</span>]</span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="cf">for</span> ax, var, gl <span class="kw">in</span> <span class="bu">zip</span>(axes.ravel(), <span class="bu">vars</span>, glabel):</span>
<span id="cb63-8"><a href="#cb63-8"></a>    az.plot_pair(</span>
<span id="cb63-9"><a href="#cb63-9"></a>        idata_mj,</span>
<span id="cb63-10"><a href="#cb63-10"></a>        var_names<span class="op">=</span>[<span class="st">"β"</span>, var],</span>
<span id="cb63-11"><a href="#cb63-11"></a>        coords<span class="op">=</span>{<span class="st">"grupo"</span>: [gl]},</span>
<span id="cb63-12"><a href="#cb63-12"></a>        divergences<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb63-13"><a href="#cb63-13"></a>        scatter_kwargs<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"C2"</span>},</span>
<span id="cb63-14"><a href="#cb63-14"></a>        divergences_kwargs<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"k"</span>, <span class="st">"marker"</span>: <span class="st">"."</span>, <span class="st">"mec"</span>: <span class="va">None</span>},</span>
<span id="cb63-15"><a href="#cb63-15"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb63-16"><a href="#cb63-16"></a>    )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ahora bien, que pasa cuando usamos un modelo jerárquico no centrado? Veamos la siguiente figura:</p>
<p>Ahora tenemos 4 paneles, en la primer fila vemos <span class="math inline">\(\log \beta_\sigma\)</span> vs <span class="math inline">\(\log \beta_{text{offset}}\)</span>, que es la nueva variable que introdujimos en la versión no centrada. Ahora vemos que el posterior es más “esférico” o al menos que la forma de embudo es mucho menos pronunciada. Esta geométrica es mucho más simple de muestrear que la anterior y por eso no observamos divergencias.</p>
<p>En la segunda fila vemos <span class="math inline">\(\log \beta_\sigma\)</span> vs <span class="math inline">\(\beta\)</span>, ahora vemos que el embudo es aún más acentuado que en la figura anterior. Esto no debería ser aún más problemático? En realidad no, esto no es un problema para el sampler por que el sampler nunca “ve” este embudo ya que <span class="math inline">\(\beta\)</span> lo obtenemos al combinar <span class="math inline">\(\beta_\text{offset}\)</span>, <span class="math inline">\(\beta_\sigma\)</span> y <span class="math inline">\(\beta_\mu\)</span>. Es decir con la reparametrización logramos obtener un embudo más “profundo”, pero sin muestrearlo directamente!</p>
<p>Ahora que quiere decir que ahora el embudo sea “más profundo”? Quiere decir que ahora somos capaces de muestrear una región de la distribución a posteriori que antes no podíamos. En la versión centrada del modelo el sampler divergía antes de poder encontrar la zona angosta y por lo tanto esa zona NO estaba presente en la distribución a posteriori. Nos estábamos perdiendo parte de la distribución a posteriori, que si no fuera por las divergencias no sabríamos que existe y estaríamos trabajando con una distribución a posteriori sesgada sin siquiera saberlo.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>idata_ncen.posterior[<span class="st">"log(β_σ)"</span>] <span class="op">=</span> np.log(idata_ncen.posterior[<span class="st">"β_σ"</span>])</span>
<span id="cb64-2"><a href="#cb64-2"></a></span>
<span id="cb64-3"><a href="#cb64-3"></a>_, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, sharey<span class="op">=</span><span class="st">"row"</span>, sharex<span class="op">=</span><span class="st">"col"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb64-4"><a href="#cb64-4"></a></span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="bu">vars</span> <span class="op">=</span> np.repeat([<span class="st">"β_offset"</span>, <span class="st">"β"</span>], <span class="dv">2</span>)</span>
<span id="cb64-6"><a href="#cb64-6"></a>glabel <span class="op">=</span> [<span class="st">"B"</span>, <span class="st">"H"</span>] <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb64-7"><a href="#cb64-7"></a></span>
<span id="cb64-8"><a href="#cb64-8"></a><span class="cf">for</span> ax, var, gl <span class="kw">in</span> <span class="bu">zip</span>(axes.ravel(), <span class="bu">vars</span>, glabel):</span>
<span id="cb64-9"><a href="#cb64-9"></a>    az.plot_pair(</span>
<span id="cb64-10"><a href="#cb64-10"></a>        idata_ncen,</span>
<span id="cb64-11"><a href="#cb64-11"></a>        var_names<span class="op">=</span>[var, <span class="st">"log(β_σ)"</span>],</span>
<span id="cb64-12"><a href="#cb64-12"></a>        coords<span class="op">=</span>{<span class="st">"grupo"</span>: [gl]},</span>
<span id="cb64-13"><a href="#cb64-13"></a>        divergences<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb64-14"><a href="#cb64-14"></a>        scatter_kwargs<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"C2"</span>},</span>
<span id="cb64-15"><a href="#cb64-15"></a>        divergences_kwargs<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"k"</span>, <span class="st">"marker"</span>: <span class="st">"."</span>, <span class="st">"mec"</span>: <span class="va">None</span>},</span>
<span id="cb64-16"><a href="#cb64-16"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb64-17"><a href="#cb64-17"></a>    )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ahora que nuestras muestras están libres de divergencias, podemos continuar con el análisis de los resultados. La siguiente figura muestra los valores estimados para <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span>. Podemos ver como las estimaciones para el grupo H son las de mayor incertidumbre. Lo cual es razonable dado que tenemos un solo punto.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a>az.plot_forest(idata_ncen, var_names<span class="op">=</span>[<span class="st">'α'</span>, <span class="st">'β'</span>], figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>), combined<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>La siguiente figura muestra las líneas ajustadas para cada uno de los ocho grupos. Podemos ver que logramos ajustar una línea a un solo punto. Al principio, esto puede sonar extraño o incluso sospechoso, pero es solo una consecuencia de la estructura del modelo jerárquico. Cada línea está informada por las líneas de los otros grupos, por lo que no estamos realmente ajustando una línea a un solo punto. En cambio, estamos ajustando una línea que ha sido informada por los puntos en los otros grupos a un solo punto.</p>
<div class="cell" data-scrolled="true" data-execution_count="43">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-2"><a href="#cb66-2"></a>ax <span class="op">=</span> np.ravel(ax)</span>
<span id="cb66-3"><a href="#cb66-3"></a>j, k <span class="op">=</span> <span class="dv">0</span>, N</span>
<span id="cb66-4"><a href="#cb66-4"></a>x_range <span class="op">=</span> np.linspace(x_m.<span class="bu">min</span>(), x_m.<span class="bu">max</span>(), <span class="dv">10</span>)</span>
<span id="cb66-5"><a href="#cb66-5"></a>posterior <span class="op">=</span> az.extract(idata_ncen)</span>
<span id="cb66-6"><a href="#cb66-6"></a></span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="cf">for</span> i, g <span class="kw">in</span> <span class="bu">enumerate</span>(grupos):</span>
<span id="cb66-8"><a href="#cb66-8"></a>    ax[i].scatter(x_m[j:k], y_m[j:k], marker<span class="op">=</span><span class="st">"."</span>)</span>
<span id="cb66-9"><a href="#cb66-9"></a>    ax[i].set_xlabel(<span class="st">"$x_</span><span class="sc">{}</span><span class="st">$"</span>.<span class="bu">format</span>(i))</span>
<span id="cb66-10"><a href="#cb66-10"></a>    ax[i].set_ylabel(<span class="st">"$y_</span><span class="sc">{}</span><span class="st">$"</span>.<span class="bu">format</span>(i), labelpad<span class="op">=</span><span class="dv">10</span>, rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb66-11"><a href="#cb66-11"></a>    alfas <span class="op">=</span> posterior[<span class="st">"α"</span>].sel(grupo<span class="op">=</span>g)</span>
<span id="cb66-12"><a href="#cb66-12"></a>    betas <span class="op">=</span> posterior[<span class="st">"β"</span>].sel(grupo<span class="op">=</span>g)</span>
<span id="cb66-13"><a href="#cb66-13"></a>    alfa_m <span class="op">=</span> alfas.mean(<span class="st">"sample"</span>).item()</span>
<span id="cb66-14"><a href="#cb66-14"></a>    beta_m <span class="op">=</span> betas.mean(<span class="st">"sample"</span>).item()</span>
<span id="cb66-15"><a href="#cb66-15"></a>    ax[i].plot(x_range, alfa_m <span class="op">+</span> beta_m <span class="op">*</span> x_range, c<span class="op">=</span><span class="st">"k"</span>)</span>
<span id="cb66-16"><a href="#cb66-16"></a>    az.plot_hdi(x_range, alfas <span class="op">+</span> betas <span class="op">*</span> xr.DataArray(x_range).transpose(), ax<span class="op">=</span>ax[i])</span>
<span id="cb66-17"><a href="#cb66-17"></a>    plt.xlim(x_m.<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, x_m.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb66-18"><a href="#cb66-18"></a>    plt.ylim(y_m.<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, y_m.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb66-19"><a href="#cb66-19"></a>    j <span class="op">+=</span> N</span>
<span id="cb66-20"><a href="#cb66-20"></a>    k <span class="op">+=</span> N</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="regresión-lineal-múltiple" class="level2" data-number="6.13">
<h2 data-number="6.13" class="anchored" data-anchor-id="regresión-lineal-múltiple"><span class="header-section-number">6.13</span> Regresión lineal múltiple</h2>
<p>Hasta ahora, hemos estado trabajando con una variable dependiente y una variable independiente. Sin embargo, no es inusual tener varias variables independientes que queremos incluir en nuestro modelo. Algunos ejemplos podrían ser:</p>
<ul>
<li>Calidad percibida del vino (dependiente) y acidez, densidad, grado alcohólico, azúcar residual y contenido de sulfatos (variables independientes)</li>
<li>Calificaciones promedio de un estudiante (dependiente) e ingreso familiar, distancia del hogar a la escuela y nivel de educación de la madre (variable categórica)</li>
</ul>
<p>Podemos extender fácilmente el modelo de regresión lineal simple para tratar con más de una variable independiente. Llamamos a este modelo regresión lineal múltiple o menos a menudo regresión lineal multivariable (que no debe confundirse con la regresión lineal multivariable, el caso en el que tenemos múltiples variables dependientes).</p>
<p>En un modelo de regresión lineal múltiple, modelamos la media de la variable dependiente de la siguiente manera:</p>
<p><span class="math display">\[
\mu = \alpha + \beta_1 X_{1} + \beta_2 X_{2} + \dots + \beta_k X_{k}
\]</span></p>
<p>Usando notación de álgebra lineal, podemos escribir una versión más corta:</p>
<p><span class="math display">\[
\mu = \alpha + \mathbf{X} \beta
\]</span></p>
<p>donde <span class="math inline">\(\mathbf{X}\)</span> es una matriz de tamaño <span class="math inline">\(n \times k\)</span> con los valores de las variables independientes y <span class="math inline">\(\beta\)</span> es un vector de tamaño <span class="math inline">\(k\)</span> con los coeficientes de las variables independientes, y $n $ es el número de observaciones.</p>
<p>Si estás un poco oxidado con respecto al álgebra lineal, podés consultar el artículo de Wikipedia sobre el producto escalar entre dos vectores y su generalización a la multiplicación de matrices. Pero básicamente, lo que necesitás saber es que solo estamos usando una forma más corta y conveniente de escribir nuestro modelo:</p>
<p><span class="math display">\[
\mathbf{X} \beta = \sum_i^n \beta_i X_{i} = \beta_1 X_{1} + \beta_2 X_{2} + \dots + \beta_k X_{k}
\]</span></p>
<p>Usando el modelo de regresión lineal simple, encontramos una línea recta que (con suerte) explica nuestros datos. Bajo el modelo de regresión lineal múltiple encontramos, en cambio, un hiperplano de dimensión <span class="math inline">\(k\)</span>. Por lo tanto, el modelo de regresión lineal múltiple es esencialmente el mismo que el modelo de regresión lineal simple, con la única diferencia de que ahora <span class="math inline">\(\beta\)</span> es un vector y <span class="math inline">\(\mathbf{X}\)</span> es una matriz.</p>
<p>Para ver un ejemplo de un modelo de regresión lineal múltiple, volvamos al ejemplo de las bicicletas. Usaremos la temperatura y la humedad del día para predecir el número de bicicletas alquiladas.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model_mlb:</span>
<span id="cb67-2"><a href="#cb67-2"></a>    α <span class="op">=</span> pm.Normal(<span class="st">"α"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb67-3"><a href="#cb67-3"></a>    β<span class="dv">0</span> <span class="op">=</span> pm.Normal(<span class="st">"β0"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb67-4"><a href="#cb67-4"></a>    β<span class="dv">1</span> <span class="op">=</span> pm.Normal(<span class="st">"β1"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb67-5"><a href="#cb67-5"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">"σ"</span>, <span class="dv">10</span>)</span>
<span id="cb67-6"><a href="#cb67-6"></a>    μ <span class="op">=</span> pm.Deterministic(<span class="st">"μ"</span>, pm.math.exp(α <span class="op">+</span> β<span class="dv">0</span> <span class="op">*</span> bicis.temperatura <span class="op">+</span> β<span class="dv">1</span> <span class="op">*</span> bicis.hora))</span>
<span id="cb67-7"><a href="#cb67-7"></a>    _ <span class="op">=</span> pm.NegativeBinomial(<span class="st">"y_pred"</span>, mu<span class="op">=</span>μ, alpha<span class="op">=</span>σ, observed<span class="op">=</span>bicis.alquiladas)</span>
<span id="cb67-8"><a href="#cb67-8"></a></span>
<span id="cb67-9"><a href="#cb67-9"></a>    idata_mlb <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [α, β0, β1, σ]</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:07&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 7 seconds.</code></pre>
</div>
</div>
<p>Tomemos un momento para comparar <code>model_mlb</code> que tiene dos variables independientes <code>temperatura</code> y <code>hora</code> con <code>model_neg</code> que solo tiene una variable independiente <code>temperatura</code>. La única diferencia es que ahora tenemos dos coeficientes <span class="math inline">\(\beta\)</span>, uno para cada variable independiente. El resto del modelo es el mismo. Podríamos haber escrito <code>β = pm.Normal("β1", mu=0, sigma=10, shape=2)</code> y luego usar <code>β1[0]</code> y <code>β1[1]</code> en la definición de <span class="math inline">\(\mu\)</span>. Yo suelo hacer eso, pero acá por ser el primer modelo de regresión múltiple, me pareció más claro escribirlo de esta manera.</p>
<p>Podemos ver que escribir un modelo de regresión múltiple no es tan diferente de escribir un modelo de regresión simple. Sin embargo, interpretar los resultados puede ser más desafiante. Por ejemplo, el coeficiente de <code>temperatura</code> ahora es <span class="math inline">\(\beta_0\)</span> y el coeficiente de <code>hora</code> es <span class="math inline">\(\beta_1\)</span>. Todavía podemos interpretar los coeficientes como el cambio en la variable dependiente por cambio unitario en la variable independiente. Pero ahora debemos tener cuidado de especificar de qué variable independiente estamos hablando. Por ejemplo, podemos decir que por una unidad de aumento en la temperatura, el número de bicicletas alquiladas aumenta en <span class="math inline">\(\beta_0\)</span> unidades, <em>manteniendo constante la hora</em>. O podemos decir que por una unidad de aumento en la hora, el número de bicicletas alquiladas aumenta en <span class="math inline">\(\beta_1\)</span> unidades, <em>manteniendo la temperatura constante</em>. Pero tenemos que entender que dado que las variables participan todas del mismo modelo, no podemos hablar de sus coeficientes de forma aislada. Esto lo podemos ver en la siguiente figura, que muestra los coeficientes <span class="math inline">\(\beta\)</span> para los modelos <code>model_neg</code> (solo <code>temperatura</code>) y para el modelo <code>model_mld</code> (<code>temperatura</code> y <code>hora</code>).</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Para hacer comparables los coeficientes los escalamos respecto de su correspondiente desviación estándar</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>idata_neg.posterior[<span class="st">"β0_scaled"</span>] <span class="op">=</span> idata_neg.posterior[<span class="st">"β"</span>] <span class="op">*</span> bicis.temperatura.std()</span>
<span id="cb70-3"><a href="#cb70-3"></a></span>
<span id="cb70-4"><a href="#cb70-4"></a>idata_mlb.posterior[<span class="st">"β0_scaled"</span>] <span class="op">=</span> idata_mlb.posterior[<span class="st">"β0"</span>] <span class="op">*</span> bicis.temperatura.std()</span>
<span id="cb70-5"><a href="#cb70-5"></a>idata_mlb.posterior[<span class="st">"β1_scaled"</span>] <span class="op">=</span> idata_mlb.posterior[<span class="st">"β1"</span>] <span class="op">*</span> bicis.hora.std()</span>
<span id="cb70-6"><a href="#cb70-6"></a></span>
<span id="cb70-7"><a href="#cb70-7"></a></span>
<span id="cb70-8"><a href="#cb70-8"></a>az.plot_forest([idata_neg, idata_mlb], model_names<span class="op">=</span>[<span class="st">"model_neg"</span>, <span class="st">"model_mlb"</span>], var_names<span class="op">=</span>[<span class="st">"β0_scaled"</span>, <span class="st">"β1_scaled"</span>], figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">3</span>), combined<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array([&lt;Axes: title={'center': '94.0% HDI'}&gt;], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Regresión_lineal_files/figure-html/cell-46-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>En la figura anterior podemos ver que el coeficiente <span class="math inline">\(\beta_0\)</span>, que se corresponde con la temperatura es diferente en ambos modelos. Esto se debe a que el efecto de la hora ya explica algunas de las variaciones en el número de bicicletas alquiladas que anteriormente solo se explicaban por la temperatura. En casos extremos, la adición de una nueva variable puede llevar el coeficiente a cero o incluso cambiar el signo. Hablaremos más de esto en el próximo capítulo.</p>
</section>
<section id="ejercicios" class="level2" data-number="6.14">
<h2 data-number="6.14" class="anchored" data-anchor-id="ejercicios"><span class="header-section-number">6.14</span> Ejercicios</h2>
<ol type="1">
<li>En la siguiente definición de modelo probabilístico cual es el <em>likelihood</em>, cual es el <em>a priori</em> y cual el <em>a posteriori</em>.</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim Normal(\mu, \sigma) \\
\mu &amp;\sim Normal(0, 10) \\
\sigma &amp;\sim HalfNormal(25)
\end{aligned}
\]</span></p>
<ol start="2" type="1">
<li><p>En el modelo del punto 1 ¿cuántos parámetros hay en el posterior? o expresado de otra forma ¿cuántas dimensiones tiene el <em>a posteriori</em>?</p></li>
<li><p>En el siguiente modelo ¿cuál es el modelo lineal? ¿cuál el likelihood y cuantos parámetros hay en la distribución a posteriori?</p></li>
</ol>
<p><span class="math display">\[
\begin{aligned}
y &amp;\sim Normal(\mu, \epsilon) \\
\mu &amp;= \alpha + \beta x \\
\alpha &amp;\sim Normal(0, 10) \\
\beta &amp;\sim Normal(0, 1) \\
\epsilon &amp;\sim HalfNormal(25) \\
\end{aligned}
\]</span></p>
<ol start="4" type="1">
<li><p>Usando el conjunto de datos <code>howell</code> (disponible junto con esta notebook) realice un modelo lineal del peso (<span class="math inline">\(x\)</span>) versus la altura (<span class="math inline">\(y\)</span>). Excluya a los menores de 18 años. Exponga los resultados.</p></li>
<li><p>Para 4 individuos se registraron los pesos (45.73, 65.8, 54.2, 32.59), pero no las alturas. Usando el modelo del punto anterior prediga la altura esperada para cada individuo junto con un intervalo de credibilidad del 50% y del 89%.</p></li>
<li><p>Repita el punto 4 pero para los menores de 18 años. Exponga los resultados.</p></li>
<li><p>Use el modelo <code>modelo_bl</code> pero aplicada al conjunto de datos iris. Intente clasificar setosa o versicolor en función de <code>sepal_length</code>. ¿Cuán útil es este modelo comparado con una regresión logística?</p></li>
<li><p>Vuelva a correr el <code>modelo_rl</code> pero esta vez usando la variable <code>petal_width</code> ¿En que difieren los resultados? ¿Cuán ancho o angosto es el intervalo HDI 94%?</p></li>
<li><p>Lea este <a href="https://twiecki.github.io/blog/2017/02/08/bayesian-hierchical-non-centered/">post</a> y replique los resultados usted mismo.</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_Diagnóstico_MCMC.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Diagnóstico del muestreo</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_Regresión_lineal_con_Bambi.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regresión lineal con Bambi</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png"></a><br>Este obra está bajo <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">licencia Creative Commons Reconocimiento 4.0 Internacional</a>.</div>
  </div>
</footer>



</body></html>